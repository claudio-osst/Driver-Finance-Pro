<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>DriverFinance Pro</title>
    <meta name="description" content="Controle de faturamento e despesas para motoristas de app.">
    <meta name="theme-color" content="#00ff88">
    <link rel="manifest" href="manifest.json">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script type="text/javascript">
        var gk_isXlsx = false;
        var gk_xlsxFileLookup = {};
        var gk_fileData = {};
        function filledCell(cell) {
            return cell !== '' && cell != null;
        }
        function loadFileData(filename) {
            if (gk_isXlsx && gk_xlsxFileLookup[filename]) {
                try {
                    var workbook = XLSX.read(gk_fileData[filename], { type: 'base64' });
                    var firstSheetName = workbook.SheetNames[0];
                    var worksheet = workbook.Sheets[firstSheetName];
                    var jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1, blankrows: false, defval: '' });
                    var filteredData = jsonData.filter(row => row.some(filledCell));
                    var headerRowIndex = filteredData.findIndex((row, index) =>
                        row.filter(filledCell).length >= filteredData[index + 1]?.filter(filledCell).length
                    );
                    if (headerRowIndex === -1 || headerRowIndex > 25) {
                        headerRowIndex = 0;
                    }
                    var csv = XLSX.utils.aoa_to_sheet(filteredData.slice(headerRowIndex));
                    csv = XLSX.utils.sheet_to_csv(csv, { header: 1 });
                    return csv;
                } catch (e) {
                    console.error(e);
                    return "";
                }
            }
            return gk_fileData[filename] || "";
        }
    </script>
	<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
	<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
	<script>
		const firebaseConfig = {
			apiKey: "**************************",
            authDomain: "driverfi**************p.com",
            projectId: "*****************",
            storageBucket: "driverfi*****************.app",
            messagingSenderId: "&&&&&&&&&&&",
            appId: "1:******************:web:*******************"
		};
		firebase.initializeApp(firebaseConfig);
	</script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        :root {
            --font-size-small: 0.875rem;
            --font-size-medium: 1rem;
            --font-size-large: 1.125rem;
            --font-size-extra-large: 1.25rem;
            --font-size-xx-large: 1.5rem;
            --font-size-xxx-large: 1.75rem;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
            transition: all 0.3s ease;
            -webkit-user-select: none;
            user-select: none;
            font-size: var(--font-size-medium);
        }
        body[data-font-size="small"] { font-size: var(--font-size-small); }
        body[data-font-size="medium"] { font-size: var(--font-size-medium); }
        body[data-font-size="large"] { font-size: var(--font-size-large); }
        body[data-font-size="extra-large"] { font-size: var(--font-size-extra-large); }
        body[data-font-size="xx-large"] { font-size: var(--font-size-xx-large); }
        body[data-font-size="xxx-large"] { font-size: var(--font-size-xxx-large); }
        [data-theme="dark"] {
            --bg-primary: #1a1a1a;
            --bg-secondary: #2d2d2d;
            --text-primary: #ffffff;
            --text-secondary: #cccccc;
            --card-bg: #252525;
            --border: #444444;
            --accent: #00ff88;
            --accent-light: #33ffaa;
            --accent-lighter: #66ffbb;
            --accent-lightest: #99ffcc;
        }
        [data-theme="light"] {
            --bg-primary: #ffffff;
            --bg-secondary: #f5f5f5;
            --text-primary: #333333;
            --text-secondary: #666666;
            --card-bg: #ffffff;
            --border: #e0e0e0;
            --accent: #007bff;
            --accent-light: #4d9bff;
            --accent-lighter: #80b3ff;
            --accent-lightest: #b3ccff;
        }
        [data-theme="blue"] {
            --bg-primary: #0d1b2a;
            --bg-secondary: #1b263b;
            --text-primary: #e0e1dd;
            --text-secondary: #a9b4c2;
            --card-bg: #16213e;
            --border: #3a506b;
            --accent: #58a6ff;
            --accent-light: #7bb8ff;
            --accent-lighter: #9ecaff;
            --accent-lightest: #c1dcff;
        }
        [data-theme="green"] {
            --bg-primary: #0f1f0f;
            --bg-secondary: #1f2f1f;
            --text-primary: #d4edda;
            --text-secondary: #a9c3b0;
            --card-bg: #1e3e1e;
            --border: #406040;
            --accent: #28a745;
            --accent-light: #4fb966;
            --accent-lighter: #76cb87;
            --accent-lightest: #9ddca8;
        }
        [data-theme="orange"] {
            --bg-primary: #2c1f0f;
            --bg-secondary: #3d2a1a;
            --text-primary: #f8e6e6;
            --text-secondary: #d4b8a0;
            --card-bg: #3c2f2f;
            --border: #5c4a3a;
            --accent: #fd7e14;
            --accent-light: #fe9743;
            --accent-lighter: #feb072;
            --accent-lightest: #ffcaa1;
        }
        [data-theme="purple"] {
            --bg-primary: #1a0f2f;
            --bg-secondary: #2a1f3f;
            --text-primary: #e2d9f3;
            --text-secondary: #c0b3d6;
            --card-bg: #2f1f4f;
            --border: #4a395f;
            --accent: #6f42c1;
            --accent-light: #8b64d1;
            --accent-lighter: #a786e1;
            --accent-lightest: #c3a8f1;
        }
        header { 
            background: var(--bg-secondary); 
            padding: 1rem; 
            text-align: center; 
            border-bottom: 1px solid var(--border); 
            position: relative;
        }
        header h1 { color: var(--accent); margin-bottom: 0.5rem; }
        
        /* Menu Hamburguer Flutuante - AGORA NO TOPO */
        .menu-toggle {
            display: none;
            position: fixed;
            top: 1rem;
            right: 1rem;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: var(--accent);
            border: 3px solid var(--bg-primary);
            color: var(--bg-primary);
            font-size: 1.3rem;
            cursor: pointer;
            z-index: 1000;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            transition: all 0.3s ease;
        }
        .menu-toggle:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 16px rgba(0,0,0,0.4);
        }
        
        nav { 
            display: flex; 
            justify-content: center; 
            background: var(--bg-secondary); 
            border-bottom: 1px solid var(--border);
            transition: all 0.3s ease;
        }
        nav button { 
            background: none; 
            border: none; 
            padding: 1rem 1.5rem; 
            color: var(--text-primary); 
            cursor: pointer; 
            transition: all 0.3s; 
            position: relative;
        }
        nav button:hover { 
            background: var(--accent); 
            color: var(--bg-primary); 
        }
		/* Bot√£o Custo KM sempre amarelo */
		nav button[onclick="showSection('custo-km')"] {
			transition: all 0.3s;
		}
		nav button[onclick="showSection('custo-km')"]:hover,
		nav button[onclick="showSection('custo-km')"].active {
			background: #FFD700 !important;
			color: #000000 !important;
		}
		nav button.active { 
			background: var(--accent); 
			color: var(--bg-primary);
			font-weight: bold;
		}
		/* Bot√£o Custo KM sempre amarelo - FOR√áADO */
		nav button[onclick*="custo-km"]:hover {
			background: #FFD700 !important;
			color: #000000 !important;
		}
		nav button[onclick*="custo-km"].active {
			background: #FFD700 !important;
			color: #000000 !important;
		}
        nav button.active::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 80%;
            height: 3px;
            background: var(--bg-primary);
            border-radius: 2px;
        }
        
        section { display: none; padding: 1rem; max-width: 1200px; margin: 0 auto; }
        section.active { display: block; }
        .card { 
            background: var(--card-bg); 
            border-radius: 12px; 
            padding: 1.5rem; 
            margin-bottom: 1rem; 
            border: 1px solid var(--border); 
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            transition: transform 0.2s ease;
        }
        .card:hover {
            transform: translateY(-2px);
        }
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem; }
        form label { display: block; margin-bottom: 0.5rem; color: var(--text-primary); font-weight: bold; }
        
        /* Inputs com borda colorida do tema */
        form input, form select { 
            width: 100%; 
            padding: 0.75rem; 
            border: 2px solid var(--accent);
            border-radius: 8px; 
            background: var(--bg-primary); 
            color: var(--text-primary);
            font-size: 1rem;
            transition: all 0.3s ease;
        }
        form input:focus, form select:focus {
            outline: none;
            box-shadow: 0 0 0 3px var(--accent-light);
        }
        
        button { 
            background: var(--accent); 
            color: var(--bg-primary); 
            border: none; 
            padding: 0.75rem 1.5rem; 
            border-radius: 8px; 
            cursor: pointer; 
            font-weight: bold; 
            transition: all 0.3s;
            font-size: 1rem;
        }
        button:hover { 
            opacity: 0.9; 
            transform: translateY(-1px);
        }
        button.danger { background: #ff4444; color: var(--bg-primary); }
        ul { list-style: none; }
        li { padding: 0.5rem; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; color: var(--text-primary); }
        canvas { max-width: 100%; height: 300px; }
        progress { width: 100%; height: 20px; }
        .meta-diaria, .meta-planejamento, .meta-semanal, .meta-mensal { 
            background: var(--card-bg); 
            padding: 1.5rem; 
            border-radius: 12px; 
            margin-bottom: 1.5rem; 
            text-align: center; 
        }
        
        /* Inputs das Metas com borda colorida */
        .meta-diaria input, .meta-planejamento input, .meta-semanal input, .meta-mensal input { 
            width: 150px; 
            margin: 0 10px; 
            color: var(--text-primary); 
            font-size: 2.5rem; 
            font-weight: bold; 
            text-align: center; 
            background: var(--bg-primary);
            border: 3px solid var(--accent);
            border-radius: 8px;
            padding: 0.5rem;
        }
        
        .meta-diaria progress { margin-top: 10px; }
        .card p.dia { font-size: 1.5rem; color: var(--accent); }
        .card p.sem { font-size: 1.3rem; color: var(--accent-light); }
        .card p.mes { font-size: 1.1rem; color: var(--accent-lighter); }
        .card p.ano { font-size: 0.9rem; color: var(--accent-lightest); }
        #metaNotification {
            display: none;
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--accent);
            color: var(--bg-primary);
            padding: 1rem 2rem;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            z-index: 1000;
            font-weight: bold;
            font-size: 1.1rem;
            max-width: 90%;
            text-align: center;
        }
        #metaNotification.show { 
            display: block; 
            animation: fadeInOut 4s forwards; 
        }
        @keyframes fadeInOut {
            0% { opacity: 0; transform: translateX(-50%) translateY(-20px); }
            10% { opacity: 1; transform: translateX(-50%) translateY(0); }
            90% { opacity: 1; transform: translateX(-50%) translateY(0); }
            100% { opacity: 0; transform: translateX(-50%) translateY(-20px); }
        }
        .filter-container { margin-bottom: 1rem; display: flex; gap: 1rem; flex-wrap: wrap; }
        .filter-container select, .filter-container input[type="date"] { 
            padding: 0.75rem; 
            border-radius: 8px; 
            border: 2px solid var(--accent); 
            background: var(--bg-primary); 
            color: var(--text-primary); 
        }
        input[type="range"] { width: 100%; margin: 0.5rem 0; accent-color: var(--accent); }
        .meta-planejamento output { display: inline-block; margin-left: 0.5rem; font-weight: bold; color: var(--accent); }
        input[type="range"] { width: 100%; margin: 0.5rem 0; accent-color: var(--accent); }
        .meta-planejamento output { display: inline-block; margin-left: 0.5rem; font-weight: bold; color: var(--accent); }
        
        /* Gr√°ficos com fundo branco e melhor visualiza√ß√£o mobile */
        .chart-container {
            background: white !important;
            padding: 1rem;
            border-radius: 8px;
            border: 2px solid var(--border);
            height: 400px; /* Aumentado para mobile */
        }
        
        /* Inputs do planejamento */
        .meta-inputs {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            justify-content: center;
            margin: 1rem 0;
        }
        .meta-input-group {
            flex: 1;
            min-width: 200px;
        }
        .meta-input-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: bold;
            color: var(--text-primary);
        }
        .meta-input-group input {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid var(--accent);
            border-radius: 8px;
            background: var(--bg-primary);
            color: var(--text-primary);
            font-size: 1.1rem;
            text-align: center;
        }
        
        /* Bot√µes em coluna no mobile */
        .button-column {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }
        .button-column button {
            width: 100%;
        }
        
        /* Modal de edi√ß√£o */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 2000;
            justify-content: center;
            align-items: center;
        }
        .modal-content {
            background: var(--card-bg);
            padding: 2rem;
            border-radius: 12px;
            max-width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            width: 600px;
        }
        .modal-header {
            display: flex;
            justify-content: between;
            align-items: center;
            margin-bottom: 1.5rem;
        }
        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            color: var(--text-primary);
            cursor: pointer;
        }
        
        /* Hist√≥rico */
        .history-item {
            background: var(--card-bg);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 0.5rem;
            transition: all 0.3s ease;
        }
        .history-item:hover {
            border-color: var(--accent);
        }
        .history-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }
        .history-date {
            font-weight: bold;
            color: var(--accent);
        }
        .history-actions {
            display: flex;
            gap: 0.5rem;
        }
        .history-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 0.5rem;
            font-size: 0.9rem;
        }
        .history-detail {
            text-align: center;
            padding: 0.25rem;
            background: var(--bg-primary);
            border-radius: 4px;
        }
        
        /* Calend√°rio */
        .calendar-container {
            background: var(--card-bg);
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1rem;
        }
        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 0.25rem;
        }
        .calendar-day {
            padding: 0.5rem;
            text-align: center;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        .calendar-day:hover {
            background: var(--accent);
            color: var(--bg-primary);
        }
        .calendar-day.has-data {
            background: var(--accent-light);
            color: var(--bg-primary);
            font-weight: bold;
        }
        .calendar-day.selected {
            background: var(--accent);
            color: var(--bg-primary);
            transform: scale(1.1);
        }
        .calendar-weekday {
            text-align: center;
            font-weight: bold;
            padding: 0.5rem;
            color: var(--text-secondary);
        }
        
/* ========== ESTILOS PARA APPS PERSONALIZADOS E DESPESAS ========== */
.custom-apps-container, .custom-expenses-container {
    margin: 1rem 0;
    padding: 1rem;
    background: var(--bg-primary);
    border-radius: 8px;
    border: 1px solid var(--border);
}

		/* CORES DIFERENCIADAS PARA CARDS DE ADI√á√ÉO */
		[data-theme="light"] .custom-apps-container,
		[data-theme="light"] .custom-expenses-container {
			background: #f8f9fa !important;
			border: 1px solid #e9ecef !important;
		}

		[data-theme="dark"] .custom-apps-container,
		[data-theme="dark"] .custom-expenses-container {
			background: #2a2a2a !important;
			border: 1px solid #444444 !important;
		}

		[data-theme="blue"] .custom-apps-container,
		[data-theme="blue"] .custom-expenses-container {
			background: #1a263b !important;
			border: 1px solid #3a506b !important;
		}

		[data-theme="green"] .custom-apps-container,
		[data-theme="green"] .custom-expenses-container {
			background: #1f2f1f !important;
			border: 1px solid #406040 !important;
		}

		[data-theme="orange"] .custom-apps-container,
		[data-theme="orange"] .custom-expenses-container {
			background: #3d2a1a !important;
			border: 1px solid #5c4a3a !important;
		}

		[data-theme="purple"] .custom-apps-container,
		[data-theme="purple"] .custom-expenses-container {
			background: #2a1f3f !important;
			border: 1px solid #4a395f !important;
		}

        .custom-input-group {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
            align-items: flex-end;
        }
        .custom-input-group input {
            flex: 1;
        }
        .custom-items-list {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-top: 0.5rem;
        }
        .custom-item-tag {
            background: var(--accent-light);
            color: var(--bg-primary);
            padding: 0.5rem 0.75rem;
            border-radius: 6px;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            border: 1px solid var(--accent);
        }
        .remove-item {
            background: none;
            border: none;
            color: var(--bg-primary);
            cursor: pointer;
            font-weight: bold;
            font-size: 1.1rem;
            padding: 0;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
        }
        .remove-item:hover {
            background: rgba(255,255,255,0.3);
        }
        
        /* Inputs din√¢micos para apps e despesas */
        .dynamic-inputs-container {
            margin: 1rem 0;
        }
        .dynamic-input-group {
            margin-bottom: 1rem;
        }
        .dynamic-input-group label {
            display: block;
            margin-bottom: 0.5rem;
            color: var(--text-primary);
            font-weight: bold;
        }
        .dynamic-input-group input {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid var(--accent);
            border-radius: 8px;
            background: var(--bg-primary);
            color: var(--text-primary);
            font-size: 1rem;
        }
        
        @media (max-width: 768px) { 
            .grid { grid-template-columns: 1fr; } 
            .menu-toggle { display: flex; align-items: center; justify-content: center; }
            nav { 
                flex-direction: column;
                position: fixed;
                top: 0;
                left: -100%;
                width: 80%;
                height: 100vh;
                background: var(--bg-secondary);
                z-index: 999;
                transition: left 0.3s ease;
                padding-top: 4rem;
            }
            nav.mobile-open {
                left: 0;
            }
            nav button { 
                flex: none; 
                padding: 1rem; 
                font-size: 1.1rem; 
                text-align: left;
                border-bottom: 1px solid var(--border);
            }
            nav button.active::after {
                display: none;
            }
            .meta-diaria input, .meta-planejamento input, .meta-semanal input, .meta-mensal input { 
                width: 100%; 
                margin: 10px 0; 
                font-size: 2rem;
            }
            .filter-container { flex-direction: column; }
            .button-column-mobile {
                display: flex;
                flex-direction: column;
                gap: 0.5rem;
            }
            .button-column-mobile button {
                width: 100%;
            }
            .history-details {
                grid-template-columns: repeat(2, 1fr);
            }
            /* Gr√°fico mobile otimizado */
            .chart-container {
                height: 350px;
                padding: 0.5rem;
            }
            .custom-input-group {
                flex-direction: column;
            }
            .custom-input-group input {
                width: 100%;
            }
        }
        .theme-btn:hover { transform: scale(1.2); box-shadow: 0 0 8px rgba(0, 0, 0, 0.3); }
        .theme-btn.active { border: 2px solid var(--text-primary); box-shadow: 0 0 10px var(--accent); }
		/* Bot√£o Custo KM Amarelo */
		.btn-custo-km:hover,
		.btn-custo-km.active {
			background: #FFD700 !important;
			color: #000000 !important;
		}

        /* ========== ESTILOS PARA ABA NOVIDADES ========== */
        .update-list {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .update-item {
            display: flex;
            gap: 1rem;
            padding: 1rem;
            background: var(--bg-primary);
            border-radius: 8px;
            border: 1px solid var(--border);
            align-items: flex-start;
        }

        .update-badge {
            background: var(--accent);
            color: white;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: bold;
            white-space: nowrap;
        }

        .update-content {
            flex: 1;
        }

        .update-content h4 {
            margin-bottom: 0.5rem;
            color: var(--text-primary);
        }

        .update-content p {
            color: var(--text-secondary);
            margin-bottom: 0.5rem;
        }

        .update-content small {
            color: var(--text-secondary);
            opacity: 0.7;
        }

        /* ========== CORRE√á√ÉO DE CORES - ABA NOVIDADES ========== */
        #novidades button {
            color: #000000 !important;
            font-weight: bold;
        }

        /* Corrige o card principal - texto branco no escuro, preto no claro */
        #novidades .card[style*="background: linear-gradient"] h2,
        #novidades .card[style*="background: linear-gradient"] p {
            color: #000000 !important;
        }

        [data-theme="dark"] #novidades .card[style*="background: linear-gradient"] h2,
        [data-theme="dark"] #novidades .card[style*="background: linear-gradient"] p {
            color: #ffffff !important;
        }
        /* ========== FIM CORRE√á√ïES ========== */

		 /* ========== FIM ESTILOS NOVIDADES ========== */

        /* ========== ESTILOS CUSTO KM ========== */
        .aba-custo-km {
            background: none;
            border: none;
            padding: 0.75rem 1.5rem;
            color: var(--text-primary);
            cursor: pointer;
            border-radius: 6px;
            transition: all 0.3s ease;
            font-weight: 500;
        }
        .aba-custo-km:hover {
            background: var(--accent-light);
            color: var(--bg-primary);
        }
        .aba-custo-km.ativa {
            background: var(--accent);
            color: var(--bg-primary);
            font-weight: bold;
        }

		/* FOR√áAR COR LILAS NOS BOT√ïES ESPEC√çFICOS */
		button[onclick="adicionarTransacao()"],
		button[onclick="adicionarDespesaPersonalizada()"] {
			background: #8A2BE2 !important;
			color: white !important;
			border: none !important;
		}

        @media (max-width: 480px) {
            header h1 { font-size: 1.5rem; } 
            .card { padding: 1rem; } 
            button { padding: 0.75rem 1rem; font-size: 0.9rem; } 
            .theme-btn { width: 25px; height: 25px; }
            .modal-content {
                padding: 1rem;
                width: 95%;
            }
            .menu-toggle {
                top: 0.5rem;
                right: 0.5rem;
                width: 45px;
                height: 45px;
                font-size: 1.1rem;
            }
            /* Ajuste final do gr√°fico para mobile muito pequeno */
            .chart-container {
                height: 300px;
            }
        }
        .ajuste-btn { font-size: 1.2rem; font-weight: bold; padding: 0.2rem 0.6rem; margin: 0 0.3rem; border-radius: 4px; }
        .range-container { display: flex; align-items: center; gap: 0.5rem; }
        .range-container input[type="range"] { flex: 1; }
        .theme-selector { display: flex; justify-content: center; gap: 0.5rem; margin-top: 1rem; }
        .theme-btn { width: 30px; height: 30px; border-radius: 50%; border: 2px solid transparent; cursor: pointer; transition: transform 0.3s ease, border 0.3s ease, box-shadow 0.3s ease; }
        .theme-btn:hover { transform: scale(1.2); box-shadow: 0 0 8px rgba(0, 0, 0, 0.3); }
        .theme-btn.active { border: 2px solid var(--text-primary); box-shadow: 0 0 10px var(--accent); }

        /* ========== ESTILOS PARA LOGIN APENAS COM EMAIL ========== */
        .login-divider {
            display: flex;
            align-items: center;
            margin: 1rem 0;
            color: var(--text-secondary);
        }
        .login-divider::before,
        .login-divider::after {
            content: '';
            flex: 1;
            height: 1px;
            background: var(--border);
        }
        .login-divider span {
            padding: 0 1rem;
            font-size: 0.9rem;
        }
        .login-form {
            display: none;
            margin-top: 1rem;
        }
        .login-form.active {
            display: block;
        }
        .form-group {
            margin-bottom: 1rem;
            text-align: left;
        }
        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            color: var(--text-primary);
            font-weight: bold;
        }
        .login-toggle {
            background: none;
            border: none;
            color: var(--accent);
            cursor: pointer;
            text-decoration: underline;
            margin-top: 1rem;
            font-size: 0.9rem;
        }
        .login-toggle:hover {
            opacity: 0.8;
        }
    </style>
</head>
<body data-theme="dark">
    <header>
        <h1>DriverFinance Pro</h1>
        <p>Controle avan√ßado de faturamento e despesas para motoristas de app</p>
    </header>
	
		<!-- TELA DE LOGIN ATUALIZADA -->
		<div id="loginScreen" style="position:fixed;top:0;left:0;width:100%;height:100%;background:var(--bg-primary);display:flex;justify-content:center;align-items:center;z-index:9999;flex-direction:column;">
			<div class="card" style="width:90%;max-width:400px;text-align:center;padding:2rem;">
				<h2>DriverFinance Pro</h2>
				<p style="margin-bottom: 1.5rem; color: var(--accent); font-weight: bold;">
					Use o mesmo e-mail da sua assinatura
				</p>
				
				<!-- Login com Google -->
				<button id="googleBtn" style="background:#4285F4;color:white;padding:12px 20px;border:none;border-radius:8px;font-weight:bold;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:10px;margin:0 auto;width:100%;margin-bottom:1rem;">
					<img src="https://www.google.com/favicon.ico" width="18" alt="G"> Entrar com Google
				</button>
				
				<div class="login-divider">
					<span>ou</span>
				</div>
				
				<!-- Login Apenas com Email -->
				<button id="toggleEmailLogin" class="login-toggle">Entrar com E-mail</button>
				
				<!-- Formul√°rio Simples de Email -->
				<div id="emailLoginForm" class="login-form">
					<div class="form-group">
						<label for="loginEmail" style="display:block; text-align:left; margin-bottom:0.5rem; color:var(--text-primary); font-weight:bold;">E-mail:</label>
						<input type="email" id="loginEmail" placeholder="seu@email.com" style="width:100%;padding:0.75rem;border:2px solid var(--accent);border-radius:8px;background:var(--bg-primary);color:var(--text-primary);">
					</div>
					<button id="emailLoginBtn" style="background:var(--accent);color:var(--bg-primary);border:none;padding:12px 20px;border-radius:8px;font-weight:bold;cursor:pointer;width:100%;margin-bottom:0.5rem;">
						Acessar Minha Conta
					</button>
					<button class="login-toggle" onclick="showLoginOptions()">Voltar</button>
				</div>
				
				<p id="erroLogin" style="color:#ff4444;margin-top:1rem;display:none;"></p>
			</div>
		</div>

		<script type="module">
			import { GoogleAuth } from '@codetrix-studio/capacitor-google-auth';
			import { getAuth, GoogleAuthProvider, signInWithCredential } from 'firebase/auth';
			import { Filesystem, Directory } from '@capacitor/filesystem';

			// Fun√ß√£o de login Google nativo
			async function loginGoogleNative() {
				try {
					const googleUser = await GoogleAuth.signIn();
					const idToken = googleUser.authentication.idToken;

					const credential = GoogleAuthProvider.credential(idToken);
					const auth = getAuth();
					const result = await signInWithCredential(auth, credential);

					console.log('Login Google nativo OK', result.user.email);

					// Salvar usu√°rio localmente
					await Filesystem.writeFile({
						path: 'user.json',
						data: JSON.stringify({
							uid: result.user.uid,
							email: result.user.email,
							loggedIn: true
						}),
						directory: Directory.Data,
						encoding: 'utf8'
					});

				} catch (err) {
					console.error('Erro login Google nativo', err);
				}
			}

			// Conecta o bot√£o de login Google √† fun√ß√£o
			document.getElementById('googleBtn').addEventListener('click', loginGoogleNative);
		</script>

    <!-- Menu Hamburguer Flutuante - AGORA NO TOPO -->
    <button class="menu-toggle" onclick="toggleMobileMenu()">‚ò∞</button>

	<nav id="mainNav">
		<button onclick="showSection('painel')" class="active">Painel</button>
		<button onclick="showSection('custo-km')" class="btn-custo-km">Custo KM</button>
		<button onclick="showSection('transacoes')">Transa√ß√µes</button>
		<button onclick="showSection('estatisticas')">Estat√≠sticas</button>
		<button onclick="showSection('imposto')">Imposto de Renda</button>
		<button onclick="showSection('historico')">Hist√≥rico</button>
		<button onclick="showSection('novidades')">Novidades</button>
		<!-- REMOVIDO: Custo KM da posi√ß√£o antiga -->
		<button onclick="showSection('configuracoes')">Configura√ß√µes</button>
	</nav>

    <main>
        <!-- Painel -->
        <section id="painel" class="active">
            <div id="metaNotification">Transa√ß√£o adicionada com sucesso!</div>
            <div class="meta-timer card" style="text-align:center; margin-bottom: 1.5rem;">
                <h2>Timer de Jornada</h2>
                <div id="timerDisplay" style="font-size:2rem; font-weight:bold; margin:10px 0;">00:00:00</div>
                <div>
                    <button id="startTimer">Iniciar</button>
                    <button id="pauseTimer">Pausar</button>
                    <button id="resetTimer">Finalizar</button>
                </div>
            </div>
            
<!-- Meta Di√°ria Pretendida -->
            <div class="meta-diaria card">
                <h2>Meta Di√°ria Pretendida</h2>
                <label>Meta Di√°ria (R$): <input type="text" id="metaDiaria" oninput="aplicarMascaraFantasma(this); salvarMetaDiaria()" placeholder="0,00"></label>
                <progress id="progressoDiario" value="0" max="100"></progress>
                <p id="progressoTextoDiario">0.0% atingido (R$ 0.00 / R$ 400,00)</p>
            </div>

            <!-- Planejamento de Meta -->
            <div class="meta-planejamento card">
                <h2>Planejamento de Meta</h2>
                <div class="meta-inputs">
                    <div class="meta-input-group">
                        <label>Faturamento M√≠nimo por KM (R$):</label>
                        <input type="text" id="metaPorKm" oninput="aplicarMascaraFantasma(this); calcularPlanejamento()" placeholder="0,00">
                    </div>
                    <div class="meta-input-group">
                        <label>Faturamento M√≠nimo por Hora (R$):</label>
                        <input type="text" id="metaPorHora" oninput="aplicarMascaraFantasma(this); calcularPlanejamento()" placeholder="0,00">
                    </div>
                </div>
                <div style="margin-top: 1rem; padding: 1rem; background: var(--bg-primary); border-radius: 8px;">
                    <h4 style="color: var(--accent); margin-bottom: 0.5rem;">Para atingir a meta di√°ria:</h4>
                    <p>Kil√¥metros necess√°rios: <span id="kmNecessarios">0.0</span></p>
                    <p>Horas necess√°rias: <span id="horasNecessarias">0.0</span></p>
                    <p>Corridas necess√°rias (estimado): <span id="corridasNecessarias">0</span></p>
                </div>
            </div>

            <!-- Meta Semanal -->
            <div class="meta-semanal card">
                <h2>Meta Semanal</h2>
                <label>Meta Semanal (R$): <input type="text" id="metaSemanal" oninput="aplicarMascaraFantasma(this); salvarMetaSemanal()" placeholder="0,00"></label>
                <progress id="progressoSemanal" value="0" max="100"></progress>
                <p id="progressoTextoSemanal">0.0% atingido (R$ 0.00 / R$ 1.500,00)</p>
            </div>

            <!-- Meta Mensal -->
            <div class="meta-mensal card">
                <h2>Meta Mensal</h2>
                <label>Meta Mensal (R$): <input type="text" id="metaMensal" oninput="aplicarMascaraFantasma(this); salvarMetaMensal()" placeholder="0,00"></label>
                <progress id="progressoMensal" value="0" max="100"></progress>
                <p id="progressoTextoMensal">0.0% atingido (R$ 0.00 / R$ 6.000,00)</p>
            </div>

            <div class="grid">
                <!-- Cards de estat√≠sticas -->
                <div class="card">
                    <h2>Ganhos</h2>
                    <p class="dia">Dia: <span id="ganhosHoje">R$ 0.00</span></p>
                    <p class="sem">Sem.: <span id="ganhosSemana">R$ 0.00</span></p>
                    <p class="mes">M√™s: <span id="ganhosMes">R$ 0.00</span></p>
                    <p class="ano">Ano: <span id="ganhosAno">R$ 0.00</span></p>
                </div>
                <div class="card">
                    <h2>Despesas</h2>
                    <p class="dia">Dia: <span id="despesasHoje">R$ 0.00</span></p>
                    <p class="sem">Sem.: <span id="despesasSemana">R$ 0.00</span></p>
                    <p class="mes">M√™s: <span id="despesasMes">R$ 0.00</span></p>
                    <p class="ano">Ano: <span id="despesasAno">R$ 0.00</span></p>
                </div>
                <div class="card">
                    <h2>Lucro L√≠quido</h2>
                    <p class="dia">Dia: <span id="lucroHoje">R$ 0.00</span></p>
                    <p class="sem">Sem.: <span id="lucroSemana">R$ 0.00</span></p>
                    <p class="mes">M√™s: <span id="lucroMes">R$ 0.00</span></p>
                    <p class="ano">Ano: <span id="lucroAno">R$ 0.00</span></p>
                </div>
                <div class="card">
                    <h2>M√©dia por Viagem</h2>
                    <p class="dia">Dia: <span id="mediaViagemHoje">R$ 0.00</span></p>
                    <p class="sem">Sem.: <span id="mediaViagemSemana">R$ 0.00</span></p>
                    <p class="mes">M√™s: <span id="mediaViagemMes">R$ 0.00</span></p>
                    <p class="ano">Ano: <span id="mediaViagemAno">R$ 0.00</span></p>
                </div>
                <div class="card">
                    <h2>Total de Corridas</h2>
                    <p class="dia">Dia: <span id="corridasHoje">0</span></p>
                    <p class="sem">Sem.: <span id="corridasSemana">0</span></p>
                    <p class="mes">M√™s: <span id="corridasMes">0</span></p>
                    <p class="ano">Ano: <span id="corridasAno">0</span></p>
                </div>
                <div class="card">
                    <h2>Faturamento/Hora</h2>
                    <p class="dia">Dia: <span id="faturamentoHoraHoje">R$ 0.00</span></p>
                    <p class="sem">Sem.: <span id="faturamentoHoraSemana">R$ 0.00</span></p>
                    <p class="mes">M√™s: <span id="faturamentoHoraMes">R$ 0.00</span></p>
                    <p class="ano">Ano: <span id="faturamentoHoraAno">R$ 0.00</span></p>
                </div>
                <div class="card">
                    <h2>Faturamento/KM</h2>
                    <p class="dia">Dia: <span id="faturamentoKmHoje">R$ 0.00</span></p>
                    <p class="sem">Sem.: <span id="faturamentoKmSemana">R$ 0.00</span></p>
                    <p class="mes">M√™s: <span id="faturamentoKmMes">R$ 0.00</span></p>
                    <p class="ano">Ano: <span id="faturamentoKmAno">R$ 0.00</span></p>
                </div>
                <div class="card">
                    <h2>Margem de Lucro</h2>
                    <p class="dia">Dia: <span id="margemLucroHoje">0.0%</span></p>
                    <p class="sem">Sem.: <span id="margemLucroSemana">0.0%</span></p>
                    <p class="mes">M√™s: <span id="margemLucroMes">0.0%</span></p>
                    <p class="ano">Ano: <span id="margemLucroAno">0.0%</span></p>
                </div>
            </div>

            <!-- Gr√°fico de Lucro L√≠quido com melhor visualiza√ß√£o mobile -->
            <div class="card">
                <h2>Evolu√ß√£o do Lucro L√≠quido (√öltimos 30 Dias)</h2>
                <div class="chart-container">
                    <canvas id="lucroChart"></canvas>
                </div>
            </div>
        </section>

<!-- Transa√ß√µes -->
<section id="transacoes">
    <div class="card">
        <h2>Adicionar Transa√ß√£o</h2>
        <form id="transacaoForm">
            <h3 style="color: var(--accent);">Faturamento</h3>
            <div class="grid">
                <div>
                    <label>
                        Uber (R$): <input type="text" id="uber" onblur="formatarMoeda(this)" placeholder="0,00">
                    </label>
                    <label>
                        99 (R$): <input type="text" id="noventaenove" onblur="formatarMoeda(this)" placeholder="0,00">
                    </label>
                    <label>
                        InDrive (R$): <input type="text" id="indrive" onblur="formatarMoeda(this)" placeholder="0,00">
                    </label>
                    <label>Particular (R$): <input type="text" id="particular" onblur="formatarMoeda(this)" placeholder="0,00"></label>
                    
                    <!-- Inputs Din√¢micos para Apps Personalizados -->
                    <div class="dynamic-inputs-container" id="appsInputsContainer">
                        <!-- Inputs para apps personalizados ser√£o gerados aqui -->
                    </div>
                </div>
            </div>

            <!-- Apps Personalizados -->
            <div class="custom-apps-container">
                <h4 style="color: var(--accent); margin-bottom: 1rem;">Outros Aplicativos</h4>
                <div class="custom-input-group">
                    <input type="text" id="novoAppInput" placeholder="Nome do app (ex: Cabify, Bolt...)" style="flex:1;">
                    <button type="button" onclick="adicionarAppPersonalizado()">+ Adicionar App</button>
                </div>
                <div class="custom-items-list" id="customAppsList">
                    <!-- Apps personalizados ser√£o adicionados aqui -->
                </div>
            </div>

            <h3 style="color: var(--accent);">Despesas</h3>
            <div class="grid">
                <div>
                    <label>
                        Combust√≠vel:
                    </label>
                    <select id="combustivelTipo">
                        <option value="gasolina">Gasolina</option>
                        <option value="etanol">Etanol</option>
                        <option value="gnv">GNV</option>
                    </select>
                    <label>Valor (R$): <input type="text" id="combustivelValor" onblur="formatarMoeda(this)" placeholder="0,00"></label>
                </div>
                <div>
					<label>
						Aluguel do Carro (R$): <input type="text" id="aluguel" onblur="formatarMoeda(this)" placeholder="0,00">
					</label>
					<label>
						Alimenta√ß√£o (R$): <input type="text" id="alimentacao" onblur="formatarMoeda(this)" placeholder="0,00">
					</label>
                    
                    <!-- CONTAINER PARA INPUTS DIN√ÇMICOS DE DESPESAS - ABAIXO DE ALIMENTA√á√ÉO -->
                    <div class="dynamic-inputs-container" id="expensesInputsContainer">
                        <!-- Inputs para despesas personalizadas ser√£o gerados aqui (abaixo de Alimenta√ß√£o) -->
                    </div>
                </div>
            </div>

            <!-- Despesas Personalizadas -->
            <div class="custom-expenses-container">
                <h4 style="color: var(--accent); margin-bottom: 1rem;">Outras Despesas</h4>
                <div class="custom-input-group">
                    <input type="text" id="novaDespesaInput" placeholder="Nome da despesa (ex: Lavagem, Estacionamento...)" style="flex:1;">
                    <button type="button" onclick="adicionarDespesaPersonalizada()">+ Adicionar Despesa</button>
                </div>
                <div class="custom-items-list" id="customExpensesList">
                    <!-- Despesas personalizadas ser√£o adicionadas aqui -->
                </div>
            </div>

            <!-- √öLTIMO CARD: M√©tricas de Trabalho -->
            <div class="card" style="margin-top: 1rem; background: var(--bg-secondary);">
                <h3 style="color: var(--accent); margin-bottom: 1rem;">üìä M√©tricas de Trabalho</h3>
                <div class="grid">
                    <div>
                        <label>
                            Quilometragem (KM): <input type="number" id="quilometragem" step="0.01" min="0" min="0">
                        </label>
                    </div>
                    <div>
                        <label>
                            Total de Corridas: <input type="number" id="totalCorridas" min="0" min="0">
                        </label>
                    </div>
                    <div>
                        <label>
                            Horas Trabalhadas: <input type="number" id="horasTrabalhadas" step="0.01" min="0" min="0">
                        </label>
                    </div>
                </div>
            </div>

            <div style="margin-top: 1.5rem; display: flex; gap: 1rem; flex-wrap: wrap;">
                <button type="button" onclick="adicionarTransacao()">Adicionar Transa√ß√£o</button>
                <button type="button" onclick="limparForm()" class="danger">Limpar</button>
            </div>
        </form>
    </div>
</section>

        <!-- Estat√≠sticas -->
        <section id="estatisticas">
            <div class="card">
                <h2>Filtro de Per√≠odo</h2>
                <div class="filter-container">
                    <select id="periodFilter">
                        <option value="all">Tudo</option>
                        <option value="today">Hoje</option>
                        <option value="last7days">√öltimos 7 Dias</option>
                        <option value="last30days">√öltimos 30 Dias</option>
                        <option value="currentMonth">M√™s Atual</option>
                        <option value="currentYear">Ano Atual</option>
                        <option value="custom">Personalizado</option>
                    </select>
                    <div id="customDateRange" style="display: none;">
                        <label>In√≠cio: <input type="date" id="dateStart"></label>
                        <label>Fim: <input type="date" id="dateEnd"></label>
                        <button type="button" onclick="applyCustomFilter()">Aplicar</button>
                    </div>
                </div>
            </div>
            <div class="card">
                <h2>Distribui√ß√£o de Ganhos</h2>
                <div class="chart-container">
                    <canvas id="ganhosChart"></canvas>
                </div>
            </div>
            <div class="card">
                <h2>Despesas por Categoria</h2>
                <div class="chart-container">
                    <canvas id="despesasChart"></canvas>
                </div>
            </div>
        </section>

        <!-- Hist√≥rico -->
        <section id="historico">
            <!-- Lista das √∫ltimas 15 transa√ß√µes -->
            <div class="card">
                <h2>√öltimas 15 Transa√ß√µes</h2>
                <div id="ultimasTransacoesList">
                    <!-- Lista ser√° preenchida por JavaScript -->
                </div>
            </div>

            <div class="card">
                <h2>Buscar Hist√≥rico por Data</h2>
                <div class="calendar-container">
                    <div class="calendar-header">
                        <button onclick="changeCalendarMonth(-1)">‚Äπ</button>
                        <h3 id="calendarMonth">M√™s Ano</h3>
                        <button onclick="changeCalendarMonth(1)">‚Ä∫</button>
                    </div>
                    <div class="calendar-grid" id="calendarGrid">
                        <!-- Dias da semana -->
                        <div class="calendar-weekday">Dom</div>
                        <div class="calendar-weekday">Seg</div>
                        <div class="calendar-weekday">Ter</div>
                        <div class="calendar-weekday">Qua</div>
                        <div class="calendar-weekday">Qui</div>
                        <div class="calendar-weekday">Sex</div>
                        <div class="calendar-weekday">S√°b</div>
                        <!-- Dias do m√™s ser√£o gerados por JavaScript -->
                    </div>
                </div>
            </div>
            
            <div class="card">
                <h2>Transa√ß√µes do Dia Selecionado</h2>
                <div id="historicoList">
                    <!-- Lista de transa√ß√µes ser√° gerada aqui -->
                </div>
            </div>
        </section>

        <!-- Imposto de Renda (NOVA ABA) -->
        <section id="imposto">
            <div class="card" style="text-align: center; background: linear-gradient(135deg, var(--accent), var(--accent-light));">
                <h2>üìä Imposto de Renda</h2>
                <p>C√°lculo automatizado para declara√ß√£o</p>
            </div>

            <div class="card">
                <h2>Resumo Anual para IR</h2>
                <div class="grid">
                    <div class="card">
                        <h3>Ganhos Totais</h3>
                        <p style="font-size: 2rem; color: var(--accent);" id="irGanhosTotais">R$ 0,00</p>
                    </div>
                    <div class="card">
                        <h3>Despesas Totais</h3>
                        <p style="font-size: 2rem; color: #ff4444;" id="irDespesasTotais">R$ 0,00</p>
                    </div>
                    <div class="card">
                        <h3>Lucro Tribut√°vel</h3>
                        <p style="font-size: 2rem; color: var(--accent-light);" id="irLucroTributavel">R$ 0,00</p>
                    </div>
                </div>
            </div>

            <div class="card">
                <h2>C√°lculo do Imposto</h2>
                <div class="grid">
                    <div class="card">
                        <h3>Al√≠quota Efetiva</h3>
                        <p style="font-size: 1.5rem; color: var(--accent);" id="irAliquota">0,0%</p>
                        <small>Baseado no lucro anual</small>
                    </div>
                    <div class="card">
                        <h3>Imposto a Pagar</h3>
                        <p style="font-size: 1.5rem; color: #ff4444;" id="irImpostoPagar">R$ 0,00</p>
                        <small>Valor estimado para declara√ß√£o</small>
                    </div>
                </div>
            </div>

            <div class="card">
                <h2>Relat√≥rio para Declara√ß√£o</h2>
                <div style="background: var(--bg-primary); padding: 1rem; border-radius: 8px; margin-bottom: 1rem;">
                    <h4 style="color: var(--accent); margin-bottom: 1rem;">Dados para o IRPF:</h4>
                    <div style="text-align: left;">
                        <p><strong>Rendimentos de Aluguel:</strong> <span id="irRendimentosAluguel">R$ 0,00</span></p>
                        <p><strong>Despesas Operacionais:</strong> <span id="irDespesasOperacionais">R$ 0,00</span></p>
                        <p><strong>Rendimento L√≠quido:</strong> <span id="irRendimentoLiquido">R$ 0,00</span></p>
                    </div>
                </div>
                <button onclick="exportarRelatorioIR()" style="background: #28a745;">üìÑ Exportar Relat√≥rio IR</button>
            </div>
        </section>

        <!-- Novidades -->
        <section id="novidades">
		<div class="card" style="text-align: center; background: linear-gradient(135deg, var(--accent), var(--accent-light));">
			<h2>üöÄ Novidades do DriverFinance Pro</h2>
			<p>Fique por dentro das atualiza√ß√µes e recursos exclusivos!</p>
		</div>

            <div class="card">
                <h2>üì¢ √öltimas Atualiza√ß√µes</h2>
                <div class="update-list">
                    <div class="update-item">
                        <div class="update-badge">NOVO</div>
                        <div class="update-content">
                            <h4>Calculadora de Imposto de Renda</h4>
                            <p>Agora voc√™ pode calcular automaticamente o imposto de renda devido com base nos seus ganhos anuais. Acesse a nova aba "Imposto de Renda" para ver o c√°lculo completo.</p>
                            <small>Lan√ßado em: 15/12/2024</small>
                        </div>
                    </div>
                    
                    <div class="update-item">
                        <div class="update-badge">MELHORIA</div>
                        <div class="update-content">
                            <h4>Planejamento de Meta Simplificado</h4>
                            <p>Reorganizamos o planejamento de metas para ser mais intuitivo. Agora voc√™ define sua meta di√°ria e planeja os m√≠nimos por KM e Hora separadamente.</p>
                            <small>Atualizado em: 10/12/2024</small>
                        </div>
                    </div>
                    
                    <div class="update-item">
                        <div class="update-badge">RECURSO</div>
                        <div class="update-content">
                            <h4>Apps Personalizados</h4>
                            <p>Adicione outros aplicativos de transporte al√©m dos principais. Perfect para quem trabalha com Cabify, Bolt, ou outros apps regionais.</p>
                            <small>Lan√ßado em: 05/12/2024</small>
                        </div>
                    </div>
                    
                    <div class="update-item">
                        <div class="update-badge">MOBILE</div>
                        <div class="update-content">
                            <h4>Otimiza√ß√£o para Dispositivos M√≥veis</h4>
                            <p>Melhoramos a experi√™ncia em smartphones com menus mais intuitivos e gr√°ficos responsivos.</p>
                            <small>Atualizado em: 01/12/2024</small>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card">
                <h2>üéØ Pr√≥ximas Funcionalidades</h2>
                <div class="update-list">
                    <div class="update-item">
                        <div class="update-badge" style="background: #6c757d;">EM BREVE</div>
                        <div class="update-content">
                            <h4>Relat√≥rios Detalhados por Per√≠odo</h4>
                            <p>Em breve: relat√≥rios personaliz√°veis por per√≠odo espec√≠fico com an√°lise de desempenho comparativo.</p>
                        </div>
                    </div>
                    
                    <div class="update-item">
                        <div class="update-badge" style="background: #6c757d;">EM BREVE</div>
                        <div class="update-content">
                            <h4>Integra√ß√£o com Planilhas</h4>
                            <p>Exporta√ß√£o autom√°tica para Google Sheets e Excel com formata√ß√£o profissional.</p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card">
                <h2>üìû Suporte e D√∫vidas</h2>
                <div style="text-align: center;">
                    <p>Precisa de ajuda? Entre em contato com nosso suporte:</p>
                    <div style="display: flex; gap: 1rem; justify-content: center; margin-top: 1rem; flex-wrap: wrap;">
                        <button onclick="abrirWhatsApp()" style="background: #25D366;">üì± WhatsApp</button>
                        <button onclick="abrirEmail()" style="background: #EA4335;">üìß E-mail</button>
                        <button onclick="abrirVideoTutorial()" style="background: #FF6B00;">üé• Tutoriais</button>
                    </div>
                </div>
            </div>
        </section>

		<!-- Custo KM -->
		<section id="custo-km">
			<iframe src="calc-custo-km.html" 
					style="width: 100%; height: 800px; border: none; border-radius: 8px;">
			</iframe>
		</section>

        <!-- Configura√ß√µes -->
        <section id="configuracoes">
			<div class="card">
                <h2>Temas</h2>
                <div class="theme-selector">
                    <button class="theme-btn" data-theme="dark" style="background: #00ff88;" title="Escuro"></button>
                    <button class="theme-btn" data-theme="light" style="background: #007bff;" title="Claro"></button>
                    <button class="theme-btn" data-theme="blue" style="background: #58a6ff;" title="Azul Profundo"></button>
                    <button class="theme-btn" data-theme="green" style="background: #28a745;" title="Verde Suave"></button>
                    <button class="theme-btn" data-theme="orange" style="background: #fd7e14;" title="Laranja Vibrante"></button>
                    <button class="theme-btn" data-theme="purple" style="background: #6f42c1;" title="Roxo Noturno"></button>
                </div>
            </div>
            <div class="card">
                <h2>Ajustes de Fonte</h2>
                <label for="fontSizeSlider">Tamanho da Fonte: <span id="fontSizeValue">M√©dio</span></label>
                <input type="range" id="fontSizeSlider" min="0" max="5" value="1" step="1">
            </div>
            <div class="card">
                <h2>Exportar/Importar</h2>
                <div class="button-column-mobile">
                    <button type="button" onclick="exportarJSON()">Exportar JSON</button>
                    <button type="button" onclick="exportarCSV()">Exportar CSV</button>
                    <button type="button" onclick="exportarPDF()">Exportar PDF</button>
                    <input type="file" id="importFile" accept=".json" style="display: none;">
                    <button type="button" onclick="document.getElementById('importFile').click();">Importar JSON</button>
                    <select id="importMode">
                        <option value="merge">Mesclar</option>
                        <option value="replace">Substituir</option>
                    </select>
                    <button type="button" onclick="confirmarImportacao()">Confirmar Importar</button>
                </div>
            </div>
            <div class="card">
                <h2>Backup e Limpeza</h2>
                <div class="button-column-mobile">
                    <button type="button" onclick="downloadBackup()">Download Backup JSON</button>
                    <button type="button" class="danger" onclick="apagarTudo()">Apagar Todos os Dados</button>
                </div>
            </div>
            <div class="card">
                <h2>Conta</h2>
                <div class="button-column-mobile">
                    <button type="button" class="danger" onclick="fazerLogout()">Sair da Conta</button>
                </div>
            </div>
            <p>Instale como PWA para uso offline (requer HTTPS).</p>
        </section>

        <footer style="text-align: center; padding: 1rem; background: var(--bg-secondary); border-top: 1px solid var(--border);">
            <p>DriverFinance Pro | desenvolvido por Claudio Gomes</p>
        </footer>
    </main>

<!-- Modal de Edi√ß√£o -->
    <div id="editModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Editar Transa√ß√£o</h2>
                <button class="modal-close" onclick="fecharModalEdicao()">√ó</button>
            </div>
            <form id="editTransacaoForm">
                <h3 style="color: var(--accent);">Faturamento</h3>
                <div class="grid">
				<div>
					<label>Uber (R$): <input type="text" id="editUber" placeholder="0,00" oninput="formatarMoeda(this)"></label>
					<label>99 (R$): <input type="text" id="editNoventaenove" placeholder="0,00" oninput="formatarMoeda(this)"></label>
					<label>InDrive (R$): <input type="text" id="editIndrive" placeholder="0,00" oninput="formatarMoeda(this)"></label>
					<label>Particular (R$): <input type="text" id="editParticular" placeholder="0,00" oninput="formatarMoeda(this)"></label>
					
					<!-- Apps Personalizados no Modal de Edi√ß√£o -->
					<div id="editAppsInputsContainer">
						<!-- Inputs para apps personalizados ser√£o gerados aqui -->
					</div>
				</div>
				<div>
					<label>Quilometragem (KM): <input type="number" id="editQuilometragem" step="0.01" min="0"></label>
					<label>Total de Corridas: <input type="number" id="editTotalCorridas" min="0"></label>
					<label>Horas Trabalhadas: <input type="number" id="editHorasTrabalhadas" step="0.01" min="0"></label>
				</div>
				</div>
                <h3 style="color: var(--accent);">Despesas</h3>
                <div class="grid">
                    <div>
                        <label>Combust√≠vel:</label>
                        <select id="editCombustivelTipo">
                            <option value="gasolina">Gasolina</option>
                            <option value="etanol">Etanol</option>
                            <option value="gnv">GNV</option>
                        </select>
                        <label>Valor (R$): <input type="text" id="editCombustivelValor" placeholder="0,00" oninput="formatarMoeda(this)"></label>
                    </div>
                    <div>
                        <label>Aluguel do Carro (R$): <input type="text" id="editAluguel" placeholder="0,00" oninput="formatarMoeda(this)"></label>
                        <label>Alimenta√ß√£o (R$): <input type="text" id="editAlimentacao" placeholder="0,00" oninput="formatarMoeda(this)"></label>
    
					<!-- Despesas Personalizadas no Modal de Edi√ß√£o -->
					<div id="editExpensesInputsContainer">
						<!-- Inputs para despesas personalizadas ser√£o gerados aqui -->
					</div>
				</div>
				</div>
                <!-- Despesas Personalizadas no Modal de Edi√ß√£o -->
                <div id="editExpensesInputsContainer">
                    <!-- Inputs para despesas personalizadas ser√£o gerados aqui -->
                </div>
                <div style="margin-top: 1.5rem; display: flex; gap: 1rem;">
                    <button type="button" onclick="salvarEdicao()">Salvar Altera√ß√µes</button>
                    <button type="button" onclick="fecharModalEdicao()">Cancelar</button>
                </div>
            </form>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.8.3/jspdf.plugin.autotable.min.js"></script>
    <script>
        // Estado global - ATUALIZADO COM NOVAS VARI√ÅVEIS
        let transacoes = []; // TODO: Migrar para appStorage
        let charts = {};
        let metaDiaria = 0; // TODO: Migrar para appStorage
        let metaPorKm = 0; // TODO: Migrar para appStorage
        let metaPorHora = 0; // TODO: Migrar para appStorage
        let metaSemanal = 00; // TODO: Migrar para appStorage
        let metaMensal = 0; // TODO: Migrar para appStorage
        let customApps = []; // TODO: Migrar para appStorage
		let customExpenses = []; // TODO: Migrar para appStorage
        let currentCalendarMonth = new Date().getMonth();
        let currentCalendarYear = new Date().getFullYear();
        let selectedDate = null;
        let editingIndex = -1;

		// Inicializa√ß√£o
		window.addEventListener('load', () => {
			// Configura√ß√µes de tema e fonte (mantidas iguais)
			const savedTheme = 'dark'; // TODO: Migrar para appStorage
			document.body.dataset.theme = savedTheme;
			aplicarTema();
			document.querySelectorAll('.theme-btn').forEach(button => {
				button.addEventListener('click', () => {
					const theme = button.dataset.theme;
					document.body.dataset.theme = theme;
					// REMOVA COMPLETAMENTE ESTA LINHA
					document.querySelectorAll('.theme-btn').forEach(btn => btn.classList.remove('active'));
					button.classList.add('active');
					aplicarTema();
					if (document.getElementById('painel').classList.contains('active')) {
						atualizarPainel();
					}
				});
			});
			const activeBtn = document.querySelector(`.theme-btn[data-theme="${savedTheme}"]`);
			if (activeBtn) activeBtn.classList.add('active');
			const fontSizeMap = ["small", "medium", "large", "extra-large", "xx-large", "xxx-large"];
			const fontSizeTextMap = ["Pequeno", "M√©dio", "Grande", "Extra Grande", "Extra Extra Grande", "Extra Extra Extra Grande"];
			const savedFontSize = "medium"; // TODO: Migrar para appStorage
			const savedFontSizeIndex = fontSizeMap.indexOf(savedFontSize);
			const fontSizeSlider = document.getElementById("fontSizeSlider");
			const fontSizeValueSpan = document.getElementById("fontSizeValue");
			if (fontSizeSlider && fontSizeValueSpan) {
				fontSizeSlider.value = savedFontSizeIndex !== -1 ? savedFontSizeIndex : 1;
				function updateFontSize(value) {
					const size = fontSizeMap[value];
					const text = fontSizeTextMap[value];
					document.body.dataset.fontSize = size;
					// REMOVA COMPLETAMENTE ESTA LINHA
					fontSizeValueSpan.textContent = text;
				}
				updateFontSize(parseInt(fontSizeSlider.value));
				fontSizeSlider.addEventListener("input", (e) => updateFontSize(parseInt(e.target.value)));
			}
			// Inicializar apps e despesas personalizadas
			atualizarListaAppsPersonalizados();
			atualizarListaDespesasPersonalizadas();
			atualizarInputsApps();
			atualizarInputsDespesas();
			// Calcular planejamento inicial
			calcularPlanejamento();
			// Filtro de gr√°ficos
			const periodFilter = document.getElementById('periodFilter');
			const customDateRange = document.getElementById('customDateRange');
			if (periodFilter && customDateRange) {
				periodFilter.addEventListener('change', (e) => {
					customDateRange.style.display = e.target.value === 'custom' ? 'flex' : 'none';
					if (e.target.value !== 'custom') inicializarGraficos();
				});
			}
			// Timer
			document.getElementById('startTimer').onclick = startTimer;
			document.getElementById('pauseTimer').onclick = pauseTimer;
			document.getElementById('resetTimer').onclick = resetTimer;
            updateTimerDisplay();
            if (timerRunning) {
                timerInterval = setInterval(updateTimerDisplay, 1000);
            }
			// Login autom√°tico
			if (false) { // TODO: Migrar para appStorage
				const loginScreen = document.getElementById('loginScreen');
				if (loginScreen) loginScreen.remove();
				showSection("painel");
				atualizarTudo();
			} else {
				showSection("painel");
			}
            // Inicializar calend√°rio
            atualizarCalendario();
            atualizarUltimasTransacoes();
			
			// Aplicar formata√ß√£o de moeda em todos os campos de R$
			const camposMoeda = ['uber', 'noventaenove', 'indrive', 'particular', 'combustivelValor', 'aluguel', 'alimentacao', 'editUber', 'editNoventaenove', 'editIndrive', 'editParticular', 'editCombustivelValor', 'editAluguel', 'editAlimentacao'];
			camposMoeda.forEach(id => {
				const input = document.getElementById(id);
				if (input) {
					input.addEventListener('input', function() {
						formatarMoeda(this);
					});
				}
			});
		});
		
        // ========== FUN√á√ïES DOS APPS PERSONALIZADOS ==========

        function adicionarAppPersonalizado() {
            const input = document.getElementById('novoAppInput');
            const nomeApp = input.value.trim();
            
            if (!nomeApp) {
                mostrarNotificacao('Digite o nome do aplicativo');
                return;
            }
            
            if (customApps.includes(nomeApp)) {
                mostrarNotificacao('Este app j√° foi adicionado');
                return;
            }
            
            customApps.push(nomeApp);
            input.value = '';
            atualizarListaAppsPersonalizados();
            atualizarInputsApps();
            mostrarNotificacao(`App "${nomeApp}" adicionado com sucesso!`);
        }

        function removerAppPersonalizado(nomeApp) {
            customApps = customApps.filter(app => app !== nomeApp);
            atualizarListaAppsPersonalizados();
            atualizarInputsApps();
            mostrarNotificacao(`App "${nomeApp}" removido`);
        }

        function atualizarListaAppsPersonalizados() {
            const container = document.getElementById('customAppsList');
            container.innerHTML = '';
            
            customApps.forEach(app => {
                const tag = document.createElement('div');
                tag.className = 'custom-item-tag';
                tag.innerHTML = `
                    ${app}
                    <button class="remove-item" onclick="removerAppPersonalizado('${app}')">√ó</button>
                `;
                container.appendChild(tag);
            });
        }

		function atualizarInputsApps() {
			const container = document.getElementById('appsInputsContainer');
			container.innerHTML = '';
			
			customApps.forEach(app => {
				const inputGroup = document.createElement('div');
				inputGroup.className = 'dynamic-input-group';
				inputGroup.innerHTML = `
					<label>${app} (R$):</label>
					<input type="text" id="app_${app.replace(/\s+/g, '_')}" placeholder="0,00">
				`;
				container.appendChild(inputGroup);
				
				// Adiciona formata√ß√£o ao input criado
				const input = document.getElementById(`app_${app.replace(/\s+/g, '_')}`);
				input.oninput = function() { formatarMoeda(this); };
			});
		}

        // ========== FUN√á√ïES DAS DESPESAS PERSONALIZADAS ==========

        function adicionarDespesaPersonalizada() {
            const input = document.getElementById('novaDespesaInput');
            const nomeDespesa = input.value.trim();
            
            if (!nomeDespesa) {
                mostrarNotificacao('Digite o nome da despesa');
                return;
            }
            
            if (customExpenses.includes(nomeDespesa)) {
                mostrarNotificacao('Esta despesa j√° foi adicionada');
                return;
            }
            
            customExpenses.push(nomeDespesa);
            input.value = '';
            atualizarListaDespesasPersonalizadas();
            atualizarInputsDespesas();
            mostrarNotificacao(`Despesa "${nomeDespesa}" adicionada com sucesso!`);
        }

        function removerDespesaPersonalizada(nomeDespesa) {
            customExpenses = customExpenses.filter(despesa => despesa !== nomeDespesa);
            atualizarListaDespesasPersonalizadas();
            atualizarInputsDespesas();
            mostrarNotificacao(`Despesa "${nomeDespesa}" removida`);
        }

        function atualizarListaDespesasPersonalizadas() {
            const container = document.getElementById('customExpensesList');
            container.innerHTML = '';
            
            customExpenses.forEach(despesa => {
                const tag = document.createElement('div');
                tag.className = 'custom-item-tag';
                tag.innerHTML = `
                    ${despesa}
                    <button class="remove-item" onclick="removerDespesaPersonalizada('${despesa}')">√ó</button>
                `;
                container.appendChild(tag);
            });
        }

			function atualizarInputsDespesas() {
            const container = document.getElementById('expensesInputsContainer');
            container.innerHTML = '';
            
            customExpenses.forEach(despesa => {
                const inputGroup = document.createElement('div');
                inputGroup.className = 'dynamic-input-group';
                inputGroup.innerHTML = `
                    <label>${despesa} (R$):</label>
                    <input type="text" id="despesa_${despesa.replace(/\s+/g, '_')}" onblur="formatarMoeda(this)" placeholder="0,00">
                `;
                container.appendChild(inputGroup);
            });
        }

        // ========== FUN√á√ïES DO PLANEJAMENTO ==========

        function salvarMetaDiaria() {
            metaDiaria = parseFloat(document.getElementById('metaDiaria').value) || 0;
            // REMOVA COMPLETAMENTE ESTA LINHA
            calcularPlanejamento();
            atualizarProgressoMetas();
        }

        function calcularPlanejamento() {
            // Salvar valores
            metaPorKm = parseFloat(document.getElementById('metaPorKm').value) || 2.00;
            metaPorHora = parseFloat(document.getElementById('metaPorHora').value) || 50;
            
            // Calcular necessidades baseadas na meta di√°ria
            const kmNecessarios = metaDiaria > 0 && metaPorKm > 0 ? metaDiaria / metaPorKm : 0.0;
            const horasNecessarias = metaDiaria > 0 && metaPorHora > 0 ? metaDiaria / metaPorHora : 0.0;
            
            // Calcular corridas necess√°rias (baseado na m√©dia hist√≥rica)
            const ultimasTransacoes = transacoes.slice(0, 30);
            const totalCorridas = ultimasTransacoes.reduce((sum, t) => sum + t.totalCorridas, 0);
            const totalKm = ultimasTransacoes.reduce((sum, t) => sum + t.quilometragem, 0);
            const totalHoras = ultimasTransacoes.reduce((sum, t) => sum + t.horasTrabalhadas, 0);
            
            const mediaKmPorCorrida = totalCorridas > 0 ? totalKm / totalCorridas : 10.0;
            const mediaHorasPorCorrida = totalCorridas > 0 ? totalHoras / totalCorridas : 0.5;
            
            const corridasPorKm = kmNecessarios > 0 && mediaKmPorCorrida > 0 ? Math.ceil(kmNecessarios / mediaKmPorCorrida) : 0;
            const corridasPorHora = horasNecessarias > 0 && mediaHorasPorCorrida > 0 ? Math.ceil(horasNecessarias / mediaHorasPorCorrida) : 0;
            
            const corridasNecessarias = Math.max(corridasPorKm, corridasPorHora);

            // Atualizar interface
            document.getElementById('kmNecessarios').textContent = kmNecessarios.toFixed(1);
            document.getElementById('horasNecessarias').textContent = horasNecessarias.toFixed(1);
            document.getElementById('corridasNecessarias').textContent = corridasNecessarias;
        }

        // Metas Semanais e Mensais
        function salvarMetaSemanal() {
            metaSemanal = parseFloat(document.getElementById('metaSemanal').value) || 0;
            atualizarProgressoMetas();
        }

        function salvarMetaMensal() {
            metaMensal = parseFloat(document.getElementById('metaMensal').value) || 0;
            atualizarProgressoMetas();
        }

        function atualizarProgressoMetas() {
            // Progresso Di√°rio
            const transacoesHoje = transacoes.filter(t => 
                new Date(t.data).toDateString() === new Date().toDateString()
            );
            const lucroHoje = transacoesHoje.reduce((sum, t) => sum + (t.ganhosTotal - t.despesasTotal), 0);
            const percentualDiario = metaDiaria > 0 ? Math.min((lucroHoje / metaDiaria) * 100, 100) : 0;
            
            document.getElementById('progressoDiario').value = percentualDiario;
            document.getElementById('progressoTextoDiario').textContent = 
                `${percentualDiario.toFixed(1)}% atingido (R$ ${lucroHoje.toFixed(2)} / R$ ${metaDiaria.toFixed(2)})`;

            // Progresso Semanal
            const inicioSemana = new Date();
            inicioSemana.setDate(inicioSemana.getDate() - inicioSemana.getDay());
            const transacoesSemana = transacoes.filter(t => new Date(t.data) >= inicioSemana);
            const lucroSemana = transacoesSemana.reduce((sum, t) => sum + (t.ganhosTotal - t.despesasTotal), 0);
            const percentualSemana = metaSemanal > 0 ? Math.min((lucroSemana / metaSemanal) * 100, 100) : 0;
            
            document.getElementById('progressoSemanal').value = percentualSemana;
            document.getElementById('progressoTextoSemanal').textContent = 
                `${percentualSemana.toFixed(1)}% atingido (R$ ${lucroSemana.toFixed(2)} / R$ ${metaSemanal.toFixed(2)})`;

            // Progresso Mensal
            const inicioMes = new Date(new Date().getFullYear(), new Date().getMonth(), 1);
            const transacoesMes = transacoes.filter(t => new Date(t.data) >= inicioMes);
            const lucroMes = transacoesMes.reduce((sum, t) => sum + (t.ganhosTotal - t.despesasTotal), 0);
            const percentualMes = metaMensal > 0 ? Math.min((lucroMes / metaMensal) * 100, 100) : 0;
            
            document.getElementById('progressoMensal').value = percentualMes;
            document.getElementById('progressoTextoMensal').textContent = 
                `${percentualMes.toFixed(1)}% atingido (R$ ${lucroMes.toFixed(2)} / R$ ${metaMensal.toFixed(2)})`;
        }

        // Imposto de Renda
        function calcularImpostoRenda() {
            const anoAtual = new Date().getFullYear();
            const transacoesAno = transacoes.filter(t => new Date(t.data).getFullYear() === anoAtual);
            
            const ganhosTotais = transacoesAno.reduce((sum, t) => sum + t.ganhosTotal, 0);
            const despesasTotais = transacoesAno.reduce((sum, t) => sum + t.despesasTotal, 0);
            const lucroTributavel = ganhosTotais - despesasTotais;
            
            // C√°lculo simplificado do IR
            let aliquota = 0;
            let impostoPagar = 0;
            
            if (lucroTributavel > 0) {
                if (lucroTributavel <= 22847.76) {
                    aliquota = 0;
                } else if (lucroTributavel <= 33919.80) {
                    aliquota = 7.5;
                    impostoPagar = (lucroTributavel * 0.075) - 1713.58;
                } else if (lucroTributavel <= 45012.60) {
                    aliquota = 15;
                    impostoPagar = (lucroTributavel * 0.15) - 4257.57;
                } else if (lucroTributavel <= 55976.16) {
                    aliquota = 22.5;
                    impostoPagar = (lucroTributavel * 0.225) - 7633.51;
                } else {
                    aliquota = 27.5;
                    impostoPagar = (lucroTributavel * 0.275) - 10432.32;
                }
                
                impostoPagar = Math.max(impostoPagar, 0);
            }
            
            // Atualizar interface
            document.getElementById('irGanhosTotais').textContent = `R$ ${ganhosTotais.toFixed(2)}`;
            document.getElementById('irDespesasTotais').textContent = `R$ ${despesasTotais.toFixed(2)}`;
            document.getElementById('irLucroTributavel').textContent = `R$ ${lucroTributavel.toFixed(2)}`;
            document.getElementById('irAliquota').textContent = `${aliquota.toFixed(1)}%`;
            document.getElementById('irImpostoPagar').textContent = `R$ ${impostoPagar.toFixed(2)}`;
            document.getElementById('irRendimentosAluguel').textContent = `R$ ${ganhosTotais.toFixed(2)}`;
            document.getElementById('irDespesasOperacionais').textContent = `R$ ${despesasTotais.toFixed(2)}`;
            document.getElementById('irRendimentoLiquido').textContent = `R$ ${lucroTributavel.toFixed(2)}`;
        }

        function exportarRelatorioIR() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            doc.setFontSize(16);
            doc.text('Relat√≥rio Anual - Imposto de Renda', 20, 20);
            doc.setFontSize(12);
            doc.text(`Motorista por Aplicativo - ${new Date().getFullYear()}`, 20, 30);
            
            doc.autoTable({
                startY: 40,
                head: [['Descri√ß√£o', 'Valor (R$)']],
                body: [
                    ['Ganhos Totais', document.getElementById('irGanhosTotais').textContent],
                    ['Despesas Totais', document.getElementById('irDespesasTotais').textContent],
                    ['Lucro Tribut√°vel', document.getElementById('irLucroTributavel').textContent],
                    ['Al√≠quota Efetiva', document.getElementById('irAliquota').textContent],
                    ['Imposto a Pagar', document.getElementById('irImpostoPagar').textContent]
                ]
            });
            
            doc.save(`relatorio_ir_${new Date().getFullYear()}.pdf`);
        }

        // ========== FUN√á√ïES EXISTENTES ATUALIZADAS ==========

        // Modificar a fun√ß√£o atualizarPainel para incluir novas metas
        function atualizarPainel() {
            const periodos = {
                hoje: { inicio: new Date().toDateString(), nome: 'Dia' },
                semana: { inicio: new Date(Date.now() - 7 * 24 * 60 * 60 * 1000), nome: 'Sem.' },
                mes: { inicio: new Date(new Date().getFullYear(), new Date().getMonth(), 1), nome: 'M√™s' },
                ano: { inicio: new Date(new Date().getFullYear(), 0, 1), nome: 'Ano' }
            };

            Object.keys(periodos).forEach(periodo => {
                const filtro = transacoes.filter(t => {
                    const transacaoData = new Date(t.data);
                    if (periodo === 'hoje') {
                        return transacaoData.toDateString() === new Date().toDateString();
                    }
                    return transacaoData >= new Date(periodos[periodo].inicio);
                });
                const ganhos = filtro.reduce((sum, t) => sum + t.ganhosTotal, 0);
                const despesas = filtro.reduce((sum, t) => sum + t.despesasTotal, 0);
                const lucro = ganhos - despesas;
                const numViagens = filtro.reduce((sum, t) => sum + t.totalCorridas, 0);
                const horasTrabalhadas = filtro.reduce((sum, t) => sum + t.horasTrabalhadas, 0);
                const quilometragem = filtro.reduce((sum, t) => sum + t.quilometragem, 0);
                const mediaViagem = numViagens > 0 ? (ganhos / numViagens) : 0;
                const faturamentoHora = horasTrabalhadas > 0 ? (ganhos / horasTrabalhadas) : 0;
                const faturamentoKm = quilometragem > 0 ? (ganhos / quilometragem) : 0;
                const margemLucro = ganhos > 0 ? ((lucro / ganhos) * 100) : 0;

                document.getElementById(`ganhos${periodo.charAt(0).toUpperCase() + periodo.slice(1)}`).textContent = `R$ ${ganhos.toFixed(2)}`;
                document.getElementById(`despesas${periodo.charAt(0).toUpperCase() + periodo.slice(1)}`).textContent = `R$ ${despesas.toFixed(2)}`;
                document.getElementById(`lucro${periodo.charAt(0).toUpperCase() + periodo.slice(1)}`).textContent = `R$ ${lucro.toFixed(2)}`;
                document.getElementById(`mediaViagem${periodo.charAt(0).toUpperCase() + periodo.slice(1)}`).textContent = `R$ ${mediaViagem.toFixed(2)}`;
                document.getElementById(`corridas${periodo.charAt(0).toUpperCase() + periodo.slice(1)}`).textContent = numViagens;
                document.getElementById(`faturamentoHora${periodo.charAt(0).toUpperCase() + periodo.slice(1)}`).textContent = `R$ ${faturamentoHora.toFixed(2)}`;
                document.getElementById(`faturamentoKm${periodo.charAt(0).toUpperCase() + periodo.slice(1)}`).textContent = `R$ ${faturamentoKm.toFixed(2)}`;
                document.getElementById(`margemLucro${periodo.charAt(0).toUpperCase() + periodo.slice(1)}`).textContent = `${margemLucro.toFixed(1)}%`;
            });

            atualizarProgressoMetas();
            calcularPlanejamento();
            atualizarGraficoLucro();
            
            // Atualizar imposto de renda se na aba correspondente
            if (document.getElementById('imposto').classList.contains('active')) {
                calcularImpostoRenda();
            }
        }

        function atualizarGraficoLucro() {
            if (charts.lucro) charts.lucro.destroy();

            // √öltimos 30 dias
            const dates = [];
            const lucros = [];
            const hoje = new Date();
            
            for (let i = 29; i >= 0; i--) {
                const date = new Date();
                date.setDate(hoje.getDate() - i);
                const dateStr = date.toDateString();
                
                const transacoesDia = transacoes.filter(t => 
                    new Date(t.data).toDateString() === dateStr
                );
                
                const ganhosDia = transacoesDia.reduce((sum, t) => sum + t.ganhosTotal, 0);
                const despesasDia = transacoesDia.reduce((sum, t) => sum + t.despesasTotal, 0);
                const lucroDia = ganhosDia - despesasDia;
                
                dates.push(date.toLocaleDateString('pt-BR', { day: '2-digit', month: '2-digit' }));
                lucros.push(lucroDia);
            }

            const ctx = document.getElementById('lucroChart').getContext('2d');
            charts.lucro = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: dates,
                    datasets: [{
                        label: 'Lucro L√≠quido (R$)',
                        data: lucros,
                        borderColor: getComputedStyle(document.documentElement).getPropertyValue('--accent'),
                        backgroundColor: getComputedStyle(document.documentElement).getPropertyValue('--accent') + '20',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return 'R$ ' + value;
                                },
                                font: {
                                    size: window.innerWidth <= 768 ? 10 : 12
                                }
                            }
                        },
                        x: {
                            ticks: {
                                font: {
                                    size: window.innerWidth <= 768 ? 10 : 12
                                }
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            labels: {
                                font: {
                                    size: window.innerWidth <= 768 ? 12 : 14
                                }
                            }
                        }
                    }
                }
            });
        }

        // Transa√ß√µes - ATUALIZADA PARA INCLUIR APPS E DESPESAS PERSONALIZADAS
        function adicionarTransacao() {
            const novaTransacao = {
                data: new Date().toISOString(),
                uber: parseFloat(document.getElementById('uber').value) || 0.00,
                noventaenove: parseFloat(document.getElementById('noventaenove').value) || 0.00,
                indrive: parseFloat(document.getElementById('indrive').value) || 0.00,
                particular: parseFloat(document.getElementById('particular').value) || 0.00,
                quilometragem: parseFloat(document.getElementById('quilometragem').value) || 0,
                totalCorridas: parseInt(document.getElementById('totalCorridas').value) || 0,
                horasTrabalhadas: parseFloat(document.getElementById('horasTrabalhadas').value) || 0.0,
                combustivel: { tipo: document.getElementById('combustivelTipo').value, valor: parseFloat(document.getElementById('combustivelValor').value) || 0.00 },
                aluguel: parseFloat(document.getElementById('aluguel').value) || 0.00,
                alimentacao: parseFloat(document.getElementById('alimentacao').value) || 0.00,
                ganhosTotal: 0.00,
                despesasTotal: 0.00
            };
            
            // Adicionar apps personalizados √† transa√ß√£o
            customApps.forEach(app => {
                const inputId = `app_${app.replace(/\s+/g, '_')}`;
                novaTransacao[app] = parseFloat(document.getElementById(inputId)?.value) || 0.00;
            });
            
            // Adicionar despesas personalizadas √† transa√ß√£o
            customExpenses.forEach(despesa => {
                const inputId = `despesa_${despesa.replace(/\s+/g, '_')}`;
                novaTransacao[despesa] = parseFloat(document.getElementById(inputId)?.value) || 0.00;
            });
            
            // Calcular ganhos totais (incluindo apps personalizados)
            novaTransacao.ganhosTotal = novaTransacao.uber + novaTransacao.noventaenove + novaTransacao.indrive + novaTransacao.particular;
            customApps.forEach(app => {
                novaTransacao.ganhosTotal += novaTransacao[app] || 0;
            });
            
            // Calcular despesas totais (incluindo despesas personalizadas)
            novaTransacao.despesasTotal = novaTransacao.combustivel.valor + novaTransacao.aluguel + novaTransacao.alimentacao;
            customExpenses.forEach(despesa => {
                novaTransacao.despesasTotal += novaTransacao[despesa] || 0;
            });

            transacoes.unshift(novaTransacao);
            limparForm();
            atualizarTudo();
            mostrarNotificacao('Transa√ß√£o adicionada com sucesso!');
        }
		
        function limparForm() {
            // Limpar campos principais
            document.getElementById('uber').value = '';
            document.getElementById('noventaenove').value = '';
            document.getElementById('indrive').value = '';
            document.getElementById('particular').value = '';
            document.getElementById('quilometragem').value = '';
            document.getElementById('horasTrabalhadas').value = '';
            document.getElementById('combustivelValor').value = '';
            document.getElementById('aluguel').value = '';
            document.getElementById('alimentacao').value = '';
            document.getElementById('totalCorridas').value = '';
            
            // Limpar inputs de apps personalizados
            customApps.forEach(app => {
                const input = document.getElementById(`app_${app.replace(/\s+/g, '_')}`);
                if (input) input.value = '';
            });
            
            // Limpar inputs de despesas personalizadas
            customExpenses.forEach(despesa => {
                const input = document.getElementById(`despesa_${despesa.replace(/\s+/g, '_')}`);
                if (input) input.value = '';
            });
        }

        function excluirTransacao(index) {
            mostrarConfirmacao('Tem certeza que deseja excluir esta transa√ß√£o?', () => {
                transacoes.splice(index, 1);
                atualizarTudo();
                mostrarNotificacao('Transa√ß√£o exclu√≠da com sucesso!');
            });
        }

        // Hist√≥rico - √öltimas 15 transa√ß√µes
        function atualizarUltimasTransacoes() {
            const ultimasList = document.getElementById('ultimasTransacoesList');
            ultimasList.innerHTML = '';
            
            const ultimas15 = transacoes.slice(0, 15);
            
            if (ultimas15.length === 0) {
                ultimasList.innerHTML = '<p style="text-align: center; color: var(--text-secondary);">Nenhuma transa√ß√£o encontrada.</p>';
                return;
            }
            
            ultimas15.forEach((transacao, index) => {
                const historyItem = document.createElement('div');
                historyItem.className = 'history-item';
                
                const dataHora = new Date(transacao.data).toLocaleString('pt-BR', { 
                    day: '2-digit',
                    month: '2-digit',
                    year: 'numeric',
                    hour: '2-digit', 
                    minute: '2-digit' 
                });
                
                historyItem.innerHTML = `
                    <div class="history-header">
                        <div class="history-date">${dataHora}</div>
                        <div class="history-actions">
                            <button onclick="editarTransacao(${index})" style="padding: 0.25rem 0.5rem; font-size: 0.8rem;">Editar</button>
                            <button onclick="excluirTransacao(${index})" class="danger" style="padding: 0.25rem 0.5rem; font-size: 0.8rem;">Excluir</button>
                        </div>
                    </div>
                    <div class="history-details">
                        <div class="history-detail">
                            <strong>Ganhos</strong><br>
                            R$ ${transacao.ganhosTotal.toFixed(2)}
                        </div>
                        <div class="history-detail">
                            <strong>Despesas</strong><br>
                            R$ ${transacao.despesasTotal.toFixed(2)}
                        </div>
                        <div class="history-detail">
                            <strong>Lucro</strong><br>
                            R$ ${(transacao.ganhosTotal - transacao.despesasTotal).toFixed(2)}
                        </div>
                        <div class="history-detail">
                            <strong>KM</strong><br>
                            ${transacao.quilometragem}
                        </div>
                        <div class="history-detail">
                            <strong>Corridas</strong><br>
                            ${transacao.totalCorridas}
                        </div>
                        <div class="history-detail">
                            <strong>Horas</strong><br>
                            ${transacao.horasTrabalhadas.toFixed(1)}
                        </div>
                    </div>
                `;
                
                ultimasList.appendChild(historyItem);
            });
        }

        // Hist√≥rico e Calend√°rio
        function atualizarCalendario() {
            const monthNames = ["Janeiro", "Fevereiro", "Mar√ßo", "Abril", "Maio", "Junho",
                               "Julho", "Agosto", "Setembro", "Outubro", "Novembro", "Dezembro"];
            
            document.getElementById('calendarMonth').textContent = 
                `${monthNames[currentCalendarMonth]} ${currentCalendarYear}`;
            
            const calendarGrid = document.getElementById('calendarGrid');
            // Limpar dias existentes (mantendo cabe√ßalho)
            while (calendarGrid.children.length > 7) {
                calendarGrid.removeChild(calendarGrid.lastChild);
            }
            
            const firstDay = new Date(currentCalendarYear, currentCalendarMonth, 1);
            const lastDay = new Date(currentCalendarYear, currentCalendarMonth + 1, 0);
            const startingDay = firstDay.getDay();
            const daysInMonth = lastDay.getDate();
            
            // Preencher dias vazios no in√≠cio
            for (let i = 0; i < startingDay; i++) {
                const emptyDay = document.createElement('div');
                emptyDay.className = 'calendar-day';
                calendarGrid.appendChild(emptyDay);
            }
            
            // Preencher dias do m√™s
            for (let day = 1; day <= daysInMonth; day++) {
                const dayElement = document.createElement('div');
                dayElement.className = 'calendar-day';
                dayElement.textContent = day;
                
                const dateStr = new Date(currentCalendarYear, currentCalendarMonth, day).toDateString();
                const hasTransactions = transacoes.some(t => 
                    new Date(t.data).toDateString() === dateStr
                );
                
                if (hasTransactions) {
                    dayElement.classList.add('has-data');
                }
                
                if (selectedDate === dateStr) {
                    dayElement.classList.add('selected');
                }
                
                dayElement.onclick = () => selecionarDia(day);
                calendarGrid.appendChild(dayElement);
            }
        }

        function changeCalendarMonth(delta) {
            currentCalendarMonth += delta;
            if (currentCalendarMonth < 0) {
                currentCalendarMonth = 11;
                currentCalendarYear--;
            } else if (currentCalendarMonth > 11) {
                currentCalendarMonth = 0;
                currentCalendarYear++;
            }
            atualizarCalendario();
        }

        function selecionarDia(day) {
            selectedDate = new Date(currentCalendarYear, currentCalendarMonth, day).toDateString();
            atualizarCalendario();
            carregarTransacoesDia();
        }

        function carregarTransacoesDia() {
            const historicoList = document.getElementById('historicoList');
            historicoList.innerHTML = '';
            
            if (!selectedDate) return;
            
            const transacoesDia = transacoes.filter(t => 
                new Date(t.data).toDateString() === selectedDate
            ).sort((a, b) => new Date(b.data) - new Date(a.data));
            
            if (transacoesDia.length === 0) {
                historicoList.innerHTML = '<p style="text-align: center; color: var(--text-secondary);">Nenhuma transa√ß√£o encontrada para este dia.</p>';
                return;
            }
            
            transacoesDia.forEach((transacao, index) => {
                const globalIndex = transacoes.findIndex(t => t.data === transacao.data);
                const historyItem = document.createElement('div');
                historyItem.className = 'history-item';
                
                const hora = new Date(transacao.data).toLocaleTimeString('pt-BR', { 
                    hour: '2-digit', 
                    minute: '2-digit' 
                });
                
                historyItem.innerHTML = `
                    <div class="history-header">
                        <div class="history-date">${hora}</div>
                        <div class="history-actions">
                            <button onclick="editarTransacao(${globalIndex})" style="padding: 0.25rem 0.5rem; font-size: 0.8rem;">Editar</button>
                            <button onclick="excluirTransacao(${globalIndex})" class="danger" style="padding: 0.25rem 0.5rem; font-size: 0.8rem;">Excluir</button>
                        </div>
                    </div>
                    <div class="history-details">
                        <div class="history-detail">
                            <strong>Ganhos</strong><br>
                            R$ ${transacao.ganhosTotal.toFixed(2)}
                        </div>
                        <div class="history-detail">
                            <strong>Despesas</strong><br>
                            R$ ${transacao.despesasTotal.toFixed(2)}
                        </div>
                        <div class="history-detail">
                            <strong>Lucro</strong><br>
                            R$ ${(transacao.ganhosTotal - transacao.despesasTotal).toFixed(2)}
                        </div>
                        <div class="history-detail">
                            <strong>KM</strong><br>
                            ${transacao.quilometragem}
                        </div>
                        <div class="history-detail">
                            <strong>Corridas</strong><br>
                            ${transacao.totalCorridas}
                        </div>
                        <div class="history-detail">
                            <strong>Horas</strong><br>
                            ${transacao.horasTrabalhadas.toFixed(1)}
                        </div>
                    </div>
                `;
                
                historicoList.appendChild(historyItem);
            });
        }

        // Edi√ß√£o de Transa√ß√µes - ATUALIZADA PARA APPS E DESPESAS PERSONALIZADAS
        function editarTransacao(index) {
            editingIndex = index;
            const transacao = transacoes[index];
            
            // Preencher campos principais
            document.getElementById('editUber').value = transacao.uber;
            document.getElementById('editNoventaenove').value = transacao.noventaenove;
            document.getElementById('editIndrive').value = transacao.indrive;
            document.getElementById('editParticular').value = transacao.particular;
            document.getElementById('editQuilometragem').value = transacao.quilometragem;
            document.getElementById('editTotalCorridas').value = transacao.totalCorridas;
            document.getElementById('editHorasTrabalhadas').value = transacao.horasTrabalhadas;
            document.getElementById('editCombustivelTipo').value = transacao.combustivel.tipo;
            document.getElementById('editCombustivelValor').value = transacao.combustivel.valor;
            document.getElementById('editAluguel').value = transacao.aluguel;
            document.getElementById('editAlimentacao').value = transacao.alimentacao;
            
            // Atualizar inputs de apps personalizados no modal
            atualizarInputsAppsModal(transacao);
            
            // Atualizar inputs de despesas personalizadas no modal
            atualizarInputsDespesasModal(transacao);
            
            document.getElementById('editModal').style.display = 'flex';
        }

        function atualizarInputsAppsModal(transacao) {
            const container = document.getElementById('editAppsInputsContainer');
            container.innerHTML = '';
            
            customApps.forEach(app => {
                const inputGroup = document.createElement('div');
                inputGroup.className = 'dynamic-input-group';
                inputGroup.innerHTML = `
                    <label>${app} (R$):</label>
                    <input type="number" id="edit_app_${app.replace(/\s+/g, '_')}" step="0.01" min="0" value="${transacao[app] || 0}">
                `;
                container.appendChild(inputGroup);
            });
        }

        function atualizarInputsDespesasModal(transacao) {
            const container = document.getElementById('editExpensesInputsContainer');
            container.innerHTML = '';
            
            customExpenses.forEach(despesa => {
                const inputGroup = document.createElement('div');
                inputGroup.className = 'dynamic-input-group';
                inputGroup.innerHTML = `
                    <label>${despesa} (R$):</label>
                    <input type="number" id="edit_despesa_${despesa.replace(/\s+/g, '_')}" step="0.01" min="0" value="${transacao[despesa] || 0}">
                `;
                container.appendChild(inputGroup);
            });
        }

        function fecharModalEdicao() {
            document.getElementById('editModal').style.display = 'none';
            editingIndex = -1;
        }

        function salvarEdicao() {
            if (editingIndex === -1) return;
            
            const transacaoEditada = {
                data: transacoes[editingIndex].data, // Mant√©m a data original
                uber: parseFloat(document.getElementById('editUber').value) || 0.00,
                noventaenove: parseFloat(document.getElementById('editNoventaenove').value) || 0.00,
                indrive: parseFloat(document.getElementById('editIndrive').value) || 0.00,
                particular: parseFloat(document.getElementById('editParticular').value) || 0.00,
                quilometragem: parseFloat(document.getElementById('editQuilometragem').value) || 0,
                totalCorridas: parseInt(document.getElementById('editTotalCorridas').value) || 0,
                horasTrabalhadas: parseFloat(document.getElementById('editHorasTrabalhadas').value) || 0.0,
                combustivel: { 
                    tipo: document.getElementById('editCombustivelTipo').value, 
                    valor: parseFloat(document.getElementById('editCombustivelValor').value) || 0.00 
                },
                aluguel: parseFloat(document.getElementById('editAluguel').value) || 0.00,
                alimentacao: parseFloat(document.getElementById('editAlimentacao').value) || 0.00,
                ganhosTotal: 0.00,
                despesasTotal: 0.00
            };
            
            // Adicionar apps personalizados
            customApps.forEach(app => {
                const inputId = `edit_app_${app.replace(/\s+/g, '_')}`;
                transacaoEditada[app] = parseFloat(document.getElementById(inputId)?.value) || 0.00;
            });
            
            // Adicionar despesas personalizadas
            customExpenses.forEach(despesa => {
                const inputId = `edit_despesa_${despesa.replace(/\s+/g, '_')}`;
                transacaoEditada[despesa] = parseFloat(document.getElementById(inputId)?.value) || 0.00;
            });
            
            // Calcular totais
            transacaoEditada.ganhosTotal = transacaoEditada.uber + transacaoEditada.noventaenove + 
                                         transacaoEditada.indrive + transacaoEditada.particular;
            customApps.forEach(app => {
                transacaoEditada.ganhosTotal += transacaoEditada[app] || 0;
            });
            
            transacaoEditada.despesasTotal = transacaoEditada.combustivel.valor + transacaoEditada.aluguel + 
                                           transacaoEditada.alimentacao;
            customExpenses.forEach(despesa => {
                transacaoEditada.despesasTotal += transacaoEditada[despesa] || 0;
            });
            
            transacoes[editingIndex] = transacaoEditada;
            
            fecharModalEdicao();
            atualizarTudo();
            mostrarNotificacao('Transa√ß√£o editada com sucesso!');
        }

        // Estat√≠sticas - ATUALIZADA PARA INCLUIR APPS E DESPESAS PERSONALIZADAS
        function getFilteredTransactions() {
            const period = document.getElementById('periodFilter').value;
            const dateStart = document.getElementById('dateStart').value ? new Date(document.getElementById('dateStart').value) : null;
            const dateEnd = document.getElementById('dateEnd').value ? new Date(document.getElementById('dateEnd').value) : null;
            const today = new Date();

            if (period === 'custom' && dateStart && dateEnd) {
                return transacoes.filter(t => {
                    const transacaoData = new Date(t.data);
                    return transacaoData >= dateStart && transacaoData <= new Date(dateEnd.getTime() + 24 * 60 * 60 * 1000 - 1);
                });
            }

            const periodos = {
                all: { inicio: new Date(0) },
                today: { inicio: today.toDateString() },
                last7days: { inicio: new Date(today.getTime() - 7 * 24 * 60 * 60 * 1000) },
                last30days: { inicio: new Date(today.getTime() - 30 * 24 * 60 * 60 * 1000) },
                currentMonth: { inicio: new Date(today.getFullYear(), today.getMonth(), 1) },
                currentYear: { inicio: new Date(today.getFullYear(), 0, 1) }
            };

            if (period in periodos) {
                return transacoes.filter(t => {
                    const transacaoData = new Date(t.data);
                    if (period === 'today') {
                        return transacaoData.toDateString() === today.toDateString();
                    }
                    return transacaoData >= periodos[period].inicio;
                });
            }
            return transacoes;
        }

        function inicializarGraficos() {
            if (charts.ganhos) charts.ganhos.destroy();
            if (charts.despesas) charts.despesas.destroy();

            const filteredTransacoes = getFilteredTransactions();

            // Preparar dados para gr√°fico de ganhos incluindo apps personalizados
            const labelsGanhos = ['Uber', '99', 'InDrive', 'Particular'];
            const dadosGanhos = [
                filteredTransacoes.reduce((sum, t) => sum + t.uber, 0),
                filteredTransacoes.reduce((sum, t) => sum + t.noventaenove, 0),
                filteredTransacoes.reduce((sum, t) => sum + t.indrive, 0),
                filteredTransacoes.reduce((sum, t) => sum + t.particular, 0)
            ];

            // Adicionar apps personalizados ao gr√°fico
            customApps.forEach(app => {
                labelsGanhos.push(app);
                dadosGanhos.push(filteredTransacoes.reduce((sum, t) => sum + (t[app] || 0), 0));
            });

            // Cores din√¢micas para gr√°fico de ganhos
            const coresGanhos = [
                '#000000', '#FFCD00', '#C1F11D', '#4BC0C0',
                '#FF6384', '#36A2EB', '#FFCE56', '#9966FF',
                '#FF9F40', '#4BC0C0', '#C9CBCF', '#FF6384'
            ].slice(0, labelsGanhos.length);

            const ctxGanhos = document.getElementById('ganhosChart').getContext('2d');
            charts.ganhos = new Chart(ctxGanhos, {
                type: 'doughnut',
                data: {
                    labels: labelsGanhos,
                    datasets: [{
                        data: dadosGanhos,
                        backgroundColor: coresGanhos
                    }]
                },
                options: { 
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { 
                        legend: { 
                            position: 'bottom', 
                            labels: { 
                                color: '#333',
                                font: {
                                    size: window.innerWidth <= 768 ? 10 : 12
                                }
                            } 
                        } 
                    } 
                }
            });

            // Preparar dados para gr√°fico de despesas incluindo despesas personalizadas
            const labelsDespesas = ['Combust√≠vel', 'Aluguel', 'Alimenta√ß√£o'];
            const dadosDespesas = [
                filteredTransacoes.reduce((sum, t) => sum + t.combustivel.valor, 0),
                filteredTransacoes.reduce((sum, t) => sum + t.aluguel, 0),
                filteredTransacoes.reduce((sum, t) => sum + t.alimentacao, 0)
            ];

            // Adicionar despesas personalizadas ao gr√°fico
            customExpenses.forEach(despesa => {
                labelsDespesas.push(despesa);
                dadosDespesas.push(filteredTransacoes.reduce((sum, t) => sum + (t[despesa] || 0), 0));
            });

            // Cores din√¢micas para gr√°fico de despesas
            const coresDespesas = [
                '#FF6384', '#FF4444', '#FFCE56', '#4BC0C0',
                '#9966FF', '#36A2EB', '#FF9F40', '#C9CBCF'
            ].slice(0, labelsDespesas.length);

            const ctxDespesas = document.getElementById('despesasChart').getContext('2d');
            charts.despesas = new Chart(ctxDespesas, {
                type: 'bar',
                data: {
                    labels: labelsDespesas,
                    datasets: [{
                        data: dadosDespesas,
                        backgroundColor: coresDespesas
                    }]
                },
                options: { 
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: { 
                        y: { 
                            beginAtZero: true, 
                            ticks: { 
                                color: '#333',
                                font: {
                                    size: window.innerWidth <= 768 ? 10 : 12
                                }
                            } 
                        },
                        x: {
                            ticks: { 
                                color: '#333',
                                font: {
                                    size: window.innerWidth <= 768 ? 10 : 12
                                }
                            }
                        }
                    }, 
                    plugins: { 
                        legend: { 
                            display: false 
                        } 
                    } 
                }
            });
        }

        function applyCustomFilter() {
            const dateStart = document.getElementById('dateStart').value;
            const dateEnd = document.getElementById('dateEnd').value;
            if (dateStart && dateEnd && new Date(dateStart) <= new Date(dateEnd)) {
                inicializarGraficos();
            } else {
                mostrarNotificacao('Datas inv√°lidas. In√≠cio deve ser antes do fim.');
            }
        }

        function atualizarEstatisticas() {
            if (document.getElementById('estatisticas').classList.contains('active')) {
                inicializarGraficos();
            }
        }

        // Configura√ß√µes
        function getThemeColor() {
            return getComputedStyle(document.documentElement).getPropertyValue('--accent').trim();
        }

        function exportarJSON() {
            const dados = { 
                transacoes, 
                metaDiaria, 
                metaPorKm, 
                metaPorHora,
                metaSemanal,
                metaMensal,
                customApps,
                customExpenses
            };
            downloadFile(JSON.stringify(dados, null, 2), 'driverfinance.json', 'application/json');
        }

        function exportarCSV() {
            let csv = 'Data,Uber,99,InDrive,Particular,Ganhos Total,Combust√≠vel,Aluguel,Alimenta√ß√£o,Despesas Total,Lucro,Horas Trabalhadas,Quilometragem,Total de Corridas';
            
            // Adicionar cabe√ßalhos para apps personalizados
            customApps.forEach(app => {
                csv += `,${app}`;
            });
            
            // Adicionar cabe√ßalhos para despesas personalizadas
            customExpenses.forEach(despesa => {
                csv += `,${despesa}`;
            });
            
            csv += '\n';
            
            transacoes.forEach(t => {
                let linha = `${t.data},R$ ${t.uber.toFixed(2)},R$ ${t.noventaenove.toFixed(2)},R$ ${t.indrive.toFixed(2)},R$ ${t.particular.toFixed(2)},R$ ${t.ganhosTotal.toFixed(2)},${t.combustivel.tipo} (R$ ${t.combustivel.valor.toFixed(2)}),R$ ${t.aluguel.toFixed(2)},R$ ${t.alimentacao.toFixed(2)},R$ ${t.despesasTotal.toFixed(2)},R$ ${(t.ganhosTotal - t.despesasTotal).toFixed(2)},${t.horasTrabalhadas.toFixed(1)},${t.quilometragem},${t.totalCorridas}`;
                
                // Adicionar dados dos apps personalizados
                customApps.forEach(app => {
                    linha += `,R$ ${(t[app] || 0).toFixed(2)}`;
                });
                
                // Adicionar dados das despesas personalizadas
                customExpenses.forEach(despesa => {
                    linha += `,R$ ${(t[despesa] || 0).toFixed(2)}`;
                });
                
                csv += linha + '\n';
            });
            downloadFile(csv, 'driverfinance.csv', 'text/csv');
        }

        function exportarPDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF({ orientation: 'portrait', unit: 'mm', format: 'a4' });
            const margin = 10;
            const themeColor = getThemeColor();
            const today = new Date().toLocaleDateString('pt-BR');

            // Cabe√ßalho
            doc.setFontSize(18);
            doc.setTextColor(themeColor);
            doc.text('Relat√≥rio DriverFinance Pro', margin, 20);
            doc.setFontSize(12);
            doc.setTextColor(0);
            doc.text(`Gerado em: ${today} | Tema: ${document.body.dataset.theme}`, margin, 30);

            // Resumo Geral
            doc.setFontSize(14);
            doc.setTextColor(themeColor);
            doc.text('Resumo Geral', margin, 40);
            doc.setFontSize(10);
            doc.setTextColor(0);

            const periodos = {
                hoje: { inicio: new Date().toDateString(), nome: 'Dia' },
                semana: { inicio: new Date(Date.now() - 7 * 24 * 60 * 60 * 1000), nome: 'Sem.' },
                mes: { inicio: new Date(new Date().getFullYear(), new Date().getMonth(), 1), nome: 'M√™s' },
                ano: { inicio: new Date(new Date().getFullYear(), 0, 1), nome: 'Ano' }
            };

            let y = 50;
            Object.keys(periodos).forEach(periodo => {
                const filtro = transacoes.filter(t => {
                    const transacaoData = new Date(t.data);
                    if (periodo === 'hoje') {
                        return transacaoData.toDateString() === new Date().toDateString();
                    }
                    return transacaoData >= new Date(periodos[periodo].inicio);
                });
                const ganhos = filtro.reduce((sum, t) => sum + t.ganhosTotal, 0);
                const despesas = filtro.reduce((sum, t) => sum + t.despesasTotal, 0);
                const lucro = ganhos - despesas;
                const numViagens = filtro.reduce((sum, t) => sum + t.totalCorridas, 0);
                const horasTrabalhadas = filtro.reduce((sum, t) => sum + t.horasTrabalhadas, 0);
                const quilometragem = filtro.reduce((sum, t) => sum + t.quilometragem, 0);
                const mediaViagem = numViagens > 0 ? (ganhos / numViagens) : 0;
                const faturamentoHora = horasTrabalhadas > 0 ? (ganhos / horasTrabalhadas) : 0;
                const faturamentoKm = quilometragem > 0 ? (ganhos / quilometragem) : 0;
                const margemLucro = ganhos > 0 ? ((lucro / ganhos) * 100) : 0;

                doc.text(`${periodos[periodo].nome}:`, margin, y);
                y += 5;
                doc.text(`Ganhos: R$ ${ganhos.toFixed(2)}`, margin + 5, y);
                doc.text(`Despesas: R$ ${despesas.toFixed(2)}`, margin + 5, y + 5);
                doc.text(`Lucro L√≠quido: R$ ${lucro.toFixed(2)}`, margin + 5, y + 10);
                doc.text(`M√©dia por Viagem: R$ ${mediaViagem.toFixed(2)}`, margin + 5, y + 15);
                doc.text(`Total de Corridas: ${numViagens}`, margin + 5, y + 20);
                doc.text(`Faturamento/Hora: R$ ${faturamentoHora.toFixed(2)}`, margin + 5, y + 25);
                doc.text(`Faturamento/KM: R$ ${faturamentoKm.toFixed(2)}`, margin + 5, y + 30);
                doc.text(`Margem de Lucro: ${margemLucro.toFixed(1)}%`, margin + 5, y + 35);
                y += 45;
                if (y > 260) { doc.addPage(); y = 20; }
            });

            // Planejamento de Meta
            doc.setFontSize(14);
            doc.setTextColor(themeColor);
            doc.text('Planejamento de Meta', margin, y);
            doc.setFontSize(10);
            doc.setTextColor(0);
            y += 10;
            const ultimasTransacoes = transacoes.slice(0, 30);
            const totalCorridas = ultimasTransacoes.reduce((sum, t) => sum + t.totalCorridas, 0);
            const totalKm = ultimasTransacoes.reduce((sum, t) => sum + t.quilometragem, 0);
            const totalHoras = ultimasTransacoes.reduce((sum, t) => sum + t.horasTrabalhadas, 0);
            const mediaKmPorCorrida = totalCorridas > 0 ? totalKm / totalCorridas : 10.0;
            const mediaHorasPorCorrida = totalCorridas > 0 ? totalHoras / totalCorridas : 0.5;
            const kmNecessarios = metaDiaria > 0 && metaPorKm > 0 ? metaDiaria / metaPorKm : 0.0;
            const horasNecessarias = metaDiaria > 0 && metaPorHora > 0 ? metaDiaria / metaPorHora : 0.0;
            const corridasNecessarias = Math.max(
                kmNecessarios > 0 && mediaKmPorCorrida > 0 ? Math.ceil(kmNecessarios / mediaKmPorCorrida) : 0,
                horasNecessarias > 0 && mediaHorasPorCorrida > 0 ? Math.ceil(horasNecessarias / mediaHorasPorCorrida) : 0
            );
            doc.text(`Meta Di√°ria: R$ ${metaDiaria.toFixed(2)}`, margin, y);
            doc.text(`Faturamento M√≠nimo por KM: R$ ${metaPorKm.toFixed(2)}`, margin, y + 5);
            doc.text(`Faturamento M√≠nimo por Hora: R$ ${metaPorHora.toFixed(2)}`, margin, y + 10);
            doc.text(`KM Necess√°rios: ${kmNecessarios.toFixed(1)}`, margin, y + 15);
            doc.text(`Horas Necess√°rias: ${horasNecessarias.toFixed(1)}`, margin, y + 20);
            doc.text(`Corridas Necess√°rias (estimado): ${corridasNecessarias}`, margin, y + 25);
            y += 35;
            if (y > 260) { doc.addPage(); y = 20; }

            // Meta Di√°ria L√≠quida
            doc.setFontSize(14);
            doc.setTextColor(themeColor);
            doc.text('Meta Di√°ria L√≠quida', margin, y);
            doc.setFontSize(10);
            doc.setTextColor(0);
            y += 10;
            const filtroHoje = transacoes.filter(t => new Date(t.data).toDateString() === new Date().toDateString());
            const ganhosHoje = filtroHoje.reduce((sum, t) => sum + t.ganhosTotal, 0);
            const despesasHoje = filtroHoje.reduce((sum, t) => sum + t.despesasTotal, 0);
            const lucroHoje = ganhosHoje - despesasHoje;
            const percentual = metaDiaria > 0 ? Math.min((lucroHoje / metaDiaria) * 100, 100) : 0;
            doc.text(`Meta: R$ ${metaDiaria.toFixed(2)}`, margin, y);
            doc.text(`Lucro L√≠quido Hoje: R$ ${lucroHoje.toFixed(2)}`, margin, y + 5);
            doc.text(`Progresso: ${percentual.toFixed(1)}%`, margin, y + 10);
            y += 20;
            if (y > 260) { doc.addPage(); y = 20; }

            // Hist√≥rico de Transa√ß√µes
            doc.setFontSize(14);
            doc.setTextColor(themeColor);
            doc.text('Hist√≥rico de Transa√ß√µes', margin, y);
            y += 10;
            
            const head = ['Data', 'Uber', '99', 'InDrive', 'Particular', 'Ganhos Total', 'Combust√≠vel', 'Aluguel', 'Alimenta√ß√£o', 'Despesas Total', 'Lucro', 'Horas', 'KM', 'Corridas'];
            
            // Adicionar cabe√ßalhos para apps personalizados
            customApps.forEach(app => {
                head.push(app);
            });
            
            // Adicionar cabe√ßalhos para despesas personalizadas
            customExpenses.forEach(despesa => {
                head.push(despesa);
            });

            const body = transacoes.map(t => {
                const row = [
                    new Date(t.data).toLocaleString('pt-BR'),
                    `R$ ${t.uber.toFixed(2)}`,
                    `R$ ${t.noventaenove.toFixed(2)}`,
                    `R$ ${t.indrive.toFixed(2)}`,
                    `R$ ${t.particular.toFixed(2)}`,
                    `R$ ${t.ganhosTotal.toFixed(2)}`,
                    `${t.combustivel.tipo} (R$ ${t.combustivel.valor.toFixed(2)})`,
                    `R$ ${t.aluguel.toFixed(2)}`,
                    `R$ ${t.alimentacao.toFixed(2)}`,
                    `R$ ${t.despesasTotal.toFixed(2)}`,
                    `R$ ${(t.ganhosTotal - t.despesasTotal).toFixed(2)}`,
                    `${t.horasTrabalhadas.toFixed(1)}`,
                    `${t.quilometragem}`,
                    `${t.totalCorridas}`
                ];
                
                // Adicionar dados dos apps personalizados
                customApps.forEach(app => {
                    row.push(`R$ ${(t[app] || 0).toFixed(2)}`);
                });
                
                // Adicionar dados das despesas personalizadas
                customExpenses.forEach(despesa => {
                    row.push(`R$ ${(t[despesa] || 0).toFixed(2)}`);
                });
                
                return row;
            });

            doc.autoTable({
                startY: y,
                head: [head],
                body: body,
                theme: 'grid',
                headStyles: { fillColor: themeColor },
                styles: { fontSize: 6, cellPadding: 1 },
                margin: { top: 10 }
            });
            
            y = doc.lastAutoTable.finalY + 10;
            if (y > 260) { doc.addPage(); y = 20; }

            // Resumo por Categoria
            doc.setFontSize(14);
            doc.setTextColor(themeColor);
            doc.text('Resumo por Categoria', margin, y);
            y += 10;
            
            const categoriasBody = [
                ['Ganhos Uber', `R$ ${transacoes.reduce((sum, t) => sum + t.uber, 0).toFixed(2)}`],
                ['Ganhos 99', `R$ ${transacoes.reduce((sum, t) => sum + t.noventaenove, 0).toFixed(2)}`],
                ['Ganhos InDrive', `R$ ${transacoes.reduce((sum, t) => sum + t.indrive, 0).toFixed(2)}`],
                ['Ganhos Particular', `R$ ${transacoes.reduce((sum, t) => sum + t.particular, 0).toFixed(2)}`],
                ['Despesas Combust√≠vel', `R$ ${transacoes.reduce((sum, t) => sum + t.combustivel.valor, 0).toFixed(2)}`],
                ['Despesas Aluguel', `R$ ${transacoes.reduce((sum, t) => sum + t.aluguel, 0).toFixed(2)}`],
                ['Despesas Alimenta√ß√£o', `R$ ${transacoes.reduce((sum, t) => sum + t.alimentacao, 0).toFixed(2)}`]
            ];
            
            // Adicionar apps personalizados ao resumo
            customApps.forEach(app => {
                const totalApp = transacoes.reduce((sum, t) => sum + (t[app] || 0), 0);
                categoriasBody.push([`Ganhos ${app}`, `R$ ${totalApp.toFixed(2)}`]);
            });
            
            // Adicionar despesas personalizadas ao resumo
            customExpenses.forEach(despesa => {
                const totalDespesa = transacoes.reduce((sum, t) => sum + (t[despesa] || 0), 0);
                categoriasBody.push([`Despesas ${despesa}`, `R$ ${totalDespesa.toFixed(2)}`]);
            });

            doc.autoTable({
                startY: y,
                head: [['Categoria', 'Total']],
                body: categoriasBody,
                theme: 'grid',
                headStyles: { fillColor: themeColor },
                styles: { fontSize: 8, cellPadding: 2 }
            });

            doc.save('driverfinance_relatorio.pdf');
        }

        function confirmarImportacao() {
            mostrarConfirmacao('Deseja importar os dados? Esta a√ß√£o ' + 
                       (document.getElementById('importMode').value === 'replace' ? 
                       'SUBSTITUIR√Å' : 'MESCLAR√Å') + ' todos os dados atuais.', importarJSON);
        }

        function importarJSON() {
            const file = document.getElementById('importFile').files[0];
            if (!file) return mostrarNotificacao('Selecione um arquivo JSON.');
            const mode = document.getElementById('importMode').value;
            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    const dados = JSON.parse(e.target.result);
                    if (mode === 'replace') {
                        transacoes = dados.transacoes || [];
                        metaDiaria = dados.metaDiaria || 400.00;
                        metaPorKm = dados.metaPorKm || 2.00;
                        metaPorHora = dados.metaPorHora || 50.00;
                        metaSemanal = dados.metaSemanal || 1500.00;
                        metaMensal = dados.metaMensal || 6000.00;
                        customApps = dados.customApps || [];
                        customExpenses = dados.customExpenses || [];
                    } else {
                        transacoes = [...transacoes, ...(dados.transacoes || [])];
                        metaDiaria = dados.metaDiaria || metaDiaria;
                        metaPorKm = dados.metaPorKm || metaPorKm;
                        metaPorHora = dados.metaPorHora || metaPorHora;
                        metaSemanal = dados.metaSemanal || metaSemanal;
                        metaMensal = dados.metaMensal || metaMensal;
                        customApps = [...new Set([...customApps, ...(dados.customApps || [])])];
                        customExpenses = [...new Set([...customExpenses, ...(dados.customExpenses || [])])];
                    }               
                   
                    atualizarListaAppsPersonalizados();
                    atualizarListaDespesasPersonalizadas();
                    atualizarInputsApps();
                    atualizarInputsDespesas();
                    calcularPlanejamento();
                    atualizarTudo();
                    mostrarNotificacao('Dados importados com sucesso!');
                } catch (err) {
                    mostrarNotificacao('Erro ao importar. Verifique o arquivo.');
                }
            };
            reader.readAsText(file);
        }

        function downloadBackup() {
            exportarJSON();
        }

        function apagarTudo() {
            mostrarConfirmacao('ATEN√á√ÉO: Isso apagar√° TODOS os dados. Confirma?', confirmarApagar);
        }
        
        function confirmarApagar() {
            transacoes = [];
            metaDiaria = 0;
            metaPorKm = 0;
            metaPorHora = 0;
            metaSemanal = 0;
            metaMensal = 0;
            customApps = [];
            customExpenses = [];
            
            atualizarListaAppsPersonalizados();
            atualizarListaDespesasPersonalizadas();
            atualizarInputsApps();
            atualizarInputsDespesas();
            calcularPlanejamento();
            mostrarNotificacao('Dados apagados com sucesso!');
            atualizarTudo();
        }

        function downloadFile(content, filename, mime) {
            const blob = new Blob([content], { type: mime });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            a.click();
            URL.revokeObjectURL(url);
        }

        function atualizarTudo() {
            atualizarPainel();
            atualizarEstatisticas();
            atualizarUltimasTransacoes();
            if (selectedDate) carregarTransacoesDia();
        }

        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('sw.js').catch((err) => console.error('Service Worker Error:', err));
        }
    
        function ajustarRange(id, delta) {
            const input = document.getElementById(id);
            let novoValor = parseFloat(input.value) + delta;
            if (novoValor < parseFloat(input.min)) novoValor = parseFloat(input.min);
            if (novoValor > parseFloat(input.max)) novoValor = parseFloat(input.max);
            input.value = novoValor.toFixed(input.step.includes('.') ? 1 : 0);
            input.dispatchEvent(new Event('input'));
        }

		// --- Timer de Jornada --- CORRIGIDO ---
		let timerInterval;
		let startTime = null;
		// TODO: Migrar para appStorage depois de testado
		// let startTime = await appStorage.getItem('timerStartTimeDF') ? parseInt(await appStorage.getItem('timerStartTimeDF')) : null;
		let elapsedSeconds = 0;
		// TODO: Migrar para appStorage depois de testado
		// let elapsedSeconds = parseInt(await appStorage.getItem('timerElapsedDF')) || 0;
		let timerRunning = false;
		// TODO: Migrar para appStorage depois de testado  
		// let timerRunning = (await appStorage.getItem('timerRunningDF')) === 'true';

		function formatTime(seconds) {
			const hours = Math.floor(seconds / 3600).toString().padStart(2, '0');
			const minutes = Math.floor((seconds % 3600) / 60).toString().padStart(2, '0');
			const secondsRemaining = (seconds % 60).toString().padStart(2, '0');
			return `${hours}:${minutes}:${secondsRemaining}`;
		}

		function updateTimerDisplay() {
			// CORRE√á√ÉO: N√ÉO modificar elapsedSeconds, s√≥ calcular para display
			const totalSeconds = startTime ? 
				elapsedSeconds + Math.floor((Date.now() - startTime) / 1000) : 
				elapsedSeconds;
			document.getElementById('timerDisplay').textContent = formatTime(totalSeconds);
		}

		function startTimer() {
			if (timerRunning) return;
			
			timerRunning = true;
			startTime = Date.now();
			// REMOVA COMPLETAMENTE ESTA LINHA
			// TODO: Migrar para appStorage depois de testado
			// await appStorage.setItem('timerStartTimeDF', startTime.toString());
			// REMOVA COMPLETAMENTE ESTA LINHA
			// TODO: Migrar para appStorage depois de testado  
			// await appStorage.setItem('timerRunningDF', 'true');
			
			timerInterval = setInterval(updateTimerDisplay, 1000);
			updateTimerDisplay();
			mostrarNotificacao('Timer iniciado!');
		}

		function pauseTimer() {
			if (!timerRunning) return;
			
			timerRunning = false;
			clearInterval(timerInterval);
			
			// üëá DEBUG ADICIONADO
			console.log('DEBUG PAUSE - elapsedSeconds antes:', elapsedSeconds);
			
			// Atualiza o tempo acumulado antes de salvar
			if (startTime) {
				const now = Date.now();
				elapsedSeconds += Math.floor((now - startTime) / 1000);
				startTime = null;
			}
			
			// üëá DEBUG ADICIONADO
			console.log('DEBUG PAUSE - elapsedSeconds depois:', elapsedSeconds);
			
			updateTimerDisplay();
			mostrarNotificacao('Timer pausado!');
		}

		function resetTimer() {
			const wasRunning = timerRunning;
			
			if (timerRunning) {
				timerRunning = false;
				clearInterval(timerInterval);
			}
			
			// Atualizar tempo final se estava rodando
			if (wasRunning && startTime) {
				const now = Date.now();
				elapsedSeconds += Math.floor((now - startTime) / 1000);
			}
			
			// Converter para horas decimais e preencher campo
			const horasDecimais = (elapsedSeconds / 3600).toFixed(2);
			const horasInput = document.getElementById('horasTrabalhadas');
			if (horasInput) {
				horasInput.value = horasDecimais;
			}
			
			// Zerar tudo
			elapsedSeconds = 0;
			startTime = null;
			
			updateTimerDisplay();
			mostrarNotificacao(`Jornada finalizada: ${horasDecimais} horas trabalhadas.`);
		}

		// Inicializar timer quando a p√°gina carregar
		window.addEventListener('load', function() {
			if (timerRunning && startTime) {
				timerInterval = setInterval(updateTimerDisplay, 1000);
			}
			updateTimerDisplay();
		});
		// --- Fim do Timer de Jornada Corrigido ---

		// --- NOTIFICA√á√ÉO UNIVERSAL ---
		function mostrarNotificacao(texto) {
			// Cria uma chave √∫nica por mensagem + data
			const hoje = new Date().toDateString();
			const chave = 'notif_' + btoa(texto + hoje).substring(0, 30);

			// Se j√° mostrou HOJE, N√ÉO mostra de novo
			// REMOVA COMPLETAMENTE ESTE IF (as 3 linhas abaixo)
			// if (localStorage.getItem(chave) === 'true') {
			//     return;
			// }

			// Mostra a notifica√ß√£o
			const notification = document.getElementById('metaNotification');
			notification.textContent = texto;
			notification.classList.remove('show');
			void notification.offsetWidth;
			notification.classList.add('show');

			// Marca como exibida hoje
			// REMOVA COMPLETAMENTE ESTA LINHA

			// Remove ap√≥s 5 segundos (mas mant√©m no storage)
			setTimeout(() => {
				notification.classList.remove('show');
			}, 5000);
		}

        // --- CONFIRMA√á√ÉO CUSTOMIZADA ---
        function mostrarConfirmacao(mensagem, callback) {
            const notification = document.getElementById('metaNotification');
            notification.innerHTML = `
                <div style="text-align: center;">
                    <div style="margin-bottom: 1rem;">${mensagem}</div>
                    <div style="display: flex; gap: 1rem; justify-content: center;">
                        <button onclick="confirmarAcao(true)" style="background: var(--accent); padding: 0.5rem 1rem; border: none; border-radius: 4px; color: white; cursor: pointer;">Sim</button>
                        <button onclick="confirmarAcao(false)" style="background: #666; padding: 0.5rem 1rem; border: none; border-radius: 4px; color: white; cursor: pointer;">N√£o</button>
                    </div>
                </div>
            `;
            
            window.confirmarAcao = function(confirmado) {
                notification.classList.remove('show');
                if (confirmado && callback) {
                    callback();
                }
                // Limpa a fun√ß√£o global tempor√°ria
                setTimeout(() => {
                    window.confirmarAcao = null;
                }, 100);
            };
            
            notification.classList.remove('show');
            void notification.offsetWidth;
            notification.classList.add('show');
        }

        // --- LOGOUT ---
        function fazerLogout() {
            mostrarConfirmacao('Deseja realmente sair da conta?', () => {
                firebase.auth().signOut();
                window.location.reload();
            });
        }

        // === URL DO SEU WEB APP (doGet) ‚Äî COLE AQUI ===
        const VERIFICACAO_URL = 'https://scr***********************************************kw/exec'; // ‚Üê SUA URL DO APPS SCRIPT

        // Fun√ß√£o para verificar e-mail no seu Apps Script
        async function verificarAcesso(email) {
            try {
                const url = `${VERIFICACAO_URL}?email=${encodeURIComponent(email)}`;
                const response = await fetch(url);
                const data = await response.json();
                return data.autorizado === true;
            } catch (error) {
                console.error('Erro ao verificar acesso:', error);
                return false;
            }
        }

        // === BOT√ÉO DE LOGIN COM VERIFICA√á√ÉO ===
        document.getElementById('googleBtn').addEventListener('click', () => {
            const provider = new firebase.auth.GoogleAuthProvider();
            firebase.auth().signInWithPopup(provider)
                .then(async (result) => {
                    const user = result.user;
                    const email = user.email;

                    // VERIFICA NO WEBHOOK ANTES DE LIBERAR
                    const permitido = await verificarAcesso(email);

                    if (permitido) {
                        document.getElementById('loginScreen').remove();
                        showSection('painel');
                        atualizarTudo();
                        mostrarNotificacao(`Bem-vindo, ${user.displayName}!`);
                    } else {
                        // BLOQUEIA ACESSO
                        firebase.auth().signOut();
                        document.getElementById('erroLogin').textContent = 'Acesso negado. Compre na Hotmart.';
                        document.getElementById('erroLogin').style.display = 'block';
                    }
                })
                .catch((error) => {
                    document.getElementById('erroLogin').textContent = 'Erro: ' + error.message;
                    document.getElementById('erroLogin').style.display = 'block';
                });
        });

        // === SEGURAN√áA AO RECARREGAR A P√ÅGINA ===
        firebase.auth().onAuthStateChanged(async (user) => {
            if (user && false) { // TODO: Migrar para appStorage
                const permitido = await verificarAcesso(user.email);
                if (permitido) {
                    document.getElementById('loginScreen')?.remove();
                    showSection('painel');
                    atualizarTudo();
                } else {
                    // FOR√áA LOGOUT SE N√ÉO FOR COMPRADOR
                    firebase.auth().signOut();
                    document.getElementById('erroLogin').textContent = 'Acesso negado. Compre na Hotmart.';
                    document.getElementById('erroLogin').style.display = 'block';
                }
            }
        });

        // === FUN√á√ïES DA ABA NOVIDADES ===
        function abrirVideoTutorial() {
            mostrarNotificacao('V√≠deos tutoriais em breve!');
        }

        function abrirWhatsApp() {
            window.open('https://wa.me/5511999999999', '_blank');
        }

        function verDivulgadores() {
            mostrarNotificacao('Lista de divulgadores em breve!');
        }

        function abrirVideoDivulgador() {
            mostrarNotificacao('Conte√∫do do divulgador em breve!');
        }

        // ========== FUN√á√ïES CUSTO KM ==========
		
        function mostrarAbaCustoKm(tipo) {
            // Remove classe ativa de todas as abas
            document.querySelectorAll('.aba-custo-km').forEach(aba => {
                aba.classList.remove('ativa');
            });
            
            // Adiciona classe ativa na aba clicada
            event.target.classList.add('ativa');
            
            // Mostra mensagem b√°sica (ser√° substitu√≠da posteriormente)
            document.getElementById('conteudo-custo-km').innerHTML = `
                <div style="text-align: center; padding: 2rem; color: var(--accent);">
                    <h3>${tipo === 'financiado' ? 'Carro Financiado' : tipo === 'alugado' ? 'Carro Alugado' : 'Carro Quitado'}</h3>
                    <p>Formul√°rio em desenvolvimento...</p>
                </div>
            `;
        }

        function abrirEmail() {
            window.location.href = 'mailto:suporte@driverfinancepro.com';
        }

        function inicializarNovidades() {
            // Fun√ß√£o para inicializar a aba de novidades
            console.log('Aba Novidades inicializada');
        }

        // Menu Hamburguer Flutuante
        function toggleMobileMenu() {
            const nav = document.getElementById('mainNav');
            nav.classList.toggle('mobile-open');
        }

        function showSection(id) {
            document.querySelectorAll('section').forEach(s => s.classList.remove('active'));
            const section = document.getElementById(id);
            if (section) section.classList.add('active');

            document.querySelectorAll('nav button').forEach(b => b.classList.remove('active'));
            const btn = document.querySelector(`nav button[onclick="showSection('${id}')"]`);
            if (btn) btn.classList.add('active');

            // Fechar menu mobile ao clicar em uma se√ß√£o
            if (window.innerWidth <= 768) {
                document.getElementById('mainNav').classList.remove('mobile-open');
            }

            if (id === 'painel') atualizarPainel();
            if (id === 'estatisticas') inicializarGraficos();
            if (id === 'historico') {
                atualizarCalendario();
                atualizarUltimasTransacoes();
            }
            if (id === 'imposto') {
                calcularImpostoRenda();
            }
            if (id === 'novidades') {
                inicializarNovidades();
            }
        }

        function aplicarTema() {
            const theme = document.body.dataset.theme;
            document.querySelectorAll('.card, .meta-diaria, .meta-planejamento, .meta-semanal, .meta-mensal, nav, header, footer').forEach(el => {
                el.style.background = getComputedStyle(document.documentElement).getPropertyValue('--bg-secondary');
                el.style.borderColor = getComputedStyle(document.documentElement).getPropertyValue('--border');
            });
            
            // Aplicar borda colorida em todos os inputs
            document.querySelectorAll('input, select').forEach(el => {
                el.style.background = getComputedStyle(document.documentElement).getPropertyValue('--bg-primary');
                el.style.color = getComputedStyle(document.documentElement).getPropertyValue('--text-primary');
                el.style.borderColor = getComputedStyle(document.documentElement).getPropertyValue('--accent');
            });
			
            document.querySelectorAll('button').forEach(el => {
                if (!el.classList.contains('danger')) {
                    el.style.background = getComputedStyle(document.documentElement).getPropertyValue('--accent');
                    el.style.color = getComputedStyle(document.documentElement).getPropertyValue('--bg-primary');
                } else {
                    el.style.color = getComputedStyle(document.documentElement).getPropertyValue('--bg-primary');
                }
            });
            document.querySelectorAll('.card p.dia').forEach(el => {
                el.style.color = getComputedStyle(document.documentElement).getPropertyValue('--accent');
            });
            document.querySelectorAll('.card p.sem').forEach(el => {
                el.style.color = getComputedStyle(document.documentElement).getPropertyValue('--accent-light');
            });
            document.querySelectorAll('.card p.mes').forEach(el => {
                el.style.color = getComputedStyle(document.documentElement).getPropertyValue('--accent-lighter');
            });
            document.querySelectorAll('.card p.ano').forEach(el => {
                el.style.color = getComputedStyle(document.documentElement).getPropertyValue('--accent-lightest');
            });
            document.querySelectorAll('.meta-planejamento output').forEach(el => {
                el.style.color = getComputedStyle(document.documentElement).getPropertyValue('--accent');
            });
        }

        // ========== FUN√á√ïES PARA LOGIN APENAS COM EMAIL ==========

        // Mostrar formul√°rio de login com email
        function showEmailForm() {
            document.getElementById('emailLoginForm').classList.add('active');
            document.getElementById('toggleEmailLogin').style.display = 'none';
        }

        // Voltar para op√ß√µes de login
        function showLoginOptions() {
            document.getElementById('emailLoginForm').classList.remove('active');
            document.getElementById('toggleEmailLogin').style.display = 'block';
        }

        // Login apenas com email
        document.getElementById('emailLoginBtn').addEventListener('click', async () => {
            const email = document.getElementById('loginEmail').value;
            const erroLogin = document.getElementById('erroLogin');

            if (!email) {
                erroLogin.textContent = 'Por favor, informe seu e-mail.';
                erroLogin.style.display = 'block';
                return;
            }

            try {
                // Verificar acesso na planilha
                const permitido = await verificarAcesso(email);
                
                if (permitido) {
                    // ACESSO LIBERADO
                    document.getElementById('loginScreen').remove();
                    showSection('painel');
                    atualizarTudo();
                    mostrarNotificacao(`Acesso liberado! Bem-vindo!`);
                } else {
                    // ACESSO NEGADO
                    erroLogin.textContent = 'E-mail n√£o encontrado. Use o mesmo e-mail da sua assinatura.';
                    erroLogin.style.display = 'block';
                }

            } catch (error) {
                erroLogin.textContent = 'Erro ao verificar acesso. Tente novamente.';
                erroLogin.style.display = 'block';
                console.error('Erro:', error);
            }
        });

        // Event listener para o bot√£o de email
        document.getElementById('toggleEmailLogin').addEventListener('click', showEmailForm);
		
		// Fun√ß√£o para formatar valor em R$ durante digita√ß√£o
		function formatarMoeda(input) {
			// Remove tudo que n√£o √© n√∫mero
			let valor = input.value.replace(/\D/g, '');
			
			if (valor === '') {
				input.value = '';
				return;
			}
			
			// Garante pelo menos 3 d√≠gitos
			valor = valor.padStart(3, '0');
			
			// Divide em reais e centavos
			let reais = valor.slice(0, -2);
			let centavos = valor.slice(-2);
			
			// Remove zeros √† esquerda
			reais = reais.replace(/^0+/, '') || '0';
			
			// Adiciona ponto nos milhares
			reais = reais.replace(/\B(?=(\d{3})+(?!\d))/g, '.');
			
			// Resultado final
			input.value = reais + ',' + centavos;
			}

			<script type="module">
			  import { GoogleAuth } from '@codetrix-studio/capacitor-google-auth';
			  import { getAuth, GoogleAuthProvider, signInWithCredential } from 'firebase/auth';
			  import { Filesystem, Directory } from '@capacitor/filesystem';

<!-- Scripts finais do app -->
<script type="module">
  import { Capacitor } from '@capacitor/core';
  import { GoogleAuth } from '@codetrix-studio/capacitor-google-auth';
  import { getAuth, GoogleAuthProvider, signInWithCredential } from 'firebase/auth';
  import { Filesystem, Directory } from '@capacitor/filesystem';

  console.log('Capacitor platform:', Capacitor.getPlatform());

  // Fun√ß√£o de login Google nativo
  async function loginGoogleNative() {
    try {
      const googleUser = await GoogleAuth.signIn();
      const idToken = googleUser.authentication.idToken;

      const credential = GoogleAuthProvider.credential(idToken);
      const auth = getAuth();
      const result = await signInWithCredential(auth, credential);

      console.log('Login Google nativo OK', result.user.email);

      // Salvar usu√°rio localmente
      await Filesystem.writeFile({
        path: 'user.json',
        data: JSON.stringify({
          uid: result.user.uid,
          email: result.user.email,
          loggedIn: true
        }),
        directory: Directory.Data,
        encoding: 'utf8'
      });

    } catch (err) {
      console.error('Erro login Google nativo', err);
    }
  }
</script>

<script src="capacitor://localhost"></script>

</body>
</html>

